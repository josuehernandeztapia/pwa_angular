import{e as R}from"./chunk-SCHFUJ5K.js";import{$ as E,A as r,V as l,k as d,n as o}from"./chunk-5IDTUAMZ.js";var p=[{from:"PO_ISSUED",to:"IN_PRODUCTION",event:"START_PROD",estimatedDays:0,requiredRole:["ops","admin"]},{from:"IN_PRODUCTION",to:"READY_AT_FACTORY",event:"FACTORY_READY",estimatedDays:30,requiredRole:["ops","admin"]},{from:"READY_AT_FACTORY",to:"AT_ORIGIN_PORT",event:"LOAD_ORIGIN",estimatedDays:5,requiredRole:["ops","admin"]},{from:"AT_ORIGIN_PORT",to:"ON_VESSEL",event:"DEPART_VESSEL",estimatedDays:0,requiredRole:["ops","admin"]},{from:"ON_VESSEL",to:"AT_DEST_PORT",event:"ARRIVE_DEST",estimatedDays:30,requiredRole:["ops","admin"]},{from:"AT_DEST_PORT",to:"IN_CUSTOMS",event:"CUSTOMS_CLEAR",estimatedDays:0,requiredRole:["ops","admin"]},{from:"IN_CUSTOMS",to:"RELEASED",event:"RELEASE",estimatedDays:10,requiredRole:["ops","admin"]},{from:"RELEASED",to:"AT_WH",event:"ARRIVE_WH",estimatedDays:2,requiredRole:["ops","admin"]},{from:"AT_WH",to:"READY_FOR_HANDOVER",event:"SCHEDULE_HANDOVER",estimatedDays:0,requiredRole:["ops","admin","advisor"]},{from:"READY_FOR_HANDOVER",to:"DELIVERED",event:"CONFIRM_DELIVERY",estimatedDays:0,requiredRole:["ops","admin","advisor","client"]}];function c(a){return p.filter(m=>m.from===a)}var s={PO_ISSUED:{title:"Orden Emitida",description:"Orden de compra enviada a f\xE1brica",color:"#6b7280",icon:"\u{1F4CB}",clientFriendly:"Procesando pedido"},IN_PRODUCTION:{title:"En Producci\xF3n",description:"Vagoneta siendo fabricada en China",color:"#f59e0b",icon:"\u{1F3ED}",clientFriendly:"En producci\xF3n"},READY_AT_FACTORY:{title:"Lista en F\xE1brica",description:"Producci\xF3n completa, lista para env\xEDo",color:"#10b981",icon:"\u2705",clientFriendly:"En producci\xF3n"},AT_ORIGIN_PORT:{title:"En Puerto Origen",description:"En puerto de China para embarque",color:"#3b82f6",icon:"\u{1F6A2}",clientFriendly:"En camino"},ON_VESSEL:{title:"En Tr\xE1nsito Mar\xEDtimo",description:"Navegando hacia M\xE9xico",color:"#0891b2",icon:"\u{1F30A}",clientFriendly:"En camino"},AT_DEST_PORT:{title:"En Puerto Destino",description:"Arrib\xF3 a puerto mexicano",color:"#8b5cf6",icon:"\u{1F3D7}\uFE0F",clientFriendly:"En camino"},IN_CUSTOMS:{title:"En Aduanas",description:"Proceso de liberaci\xF3n aduanal",color:"#f59e0b",icon:"\u{1F4C4}",clientFriendly:"En camino"},RELEASED:{title:"Liberado",description:"Liberado de aduanas, en transporte local",color:"#10b981",icon:"\u{1F69B}",clientFriendly:"En camino"},AT_WH:{title:"En Bodega",description:"En bodega local, preparando entrega",color:"#06d6a0",icon:"\u{1F3EA}",clientFriendly:"Lista para entrega"},READY_FOR_HANDOVER:{title:"Lista para Entrega",description:"Lista para coordinar entrega con cliente",color:"#059669",icon:"\u{1F3AF}",clientFriendly:"Lista para entrega"},DELIVERED:{title:"Entregada",description:"Entregada exitosamente al cliente",color:"#065f46",icon:"\u{1F389}",clientFriendly:"Entregada"}},u={ISSUE_PO:{title:"Orden Emitida",description:"Orden de compra enviada a proveedor",icon:"\u{1F4CB}"},START_PROD:{title:"Inicio de Producci\xF3n",description:"Comenz\xF3 el proceso de fabricaci\xF3n",icon:"\u{1F3ED}"},FACTORY_READY:{title:"Lista en F\xE1brica",description:"Producci\xF3n completada exitosamente",icon:"\u2705"},LOAD_ORIGIN:{title:"Carga en Puerto",description:"Cargada en contenedor para embarque",icon:"\u{1F4E6}"},DEPART_VESSEL:{title:"Embarcaci\xF3n Zarp\xF3",description:"Inici\xF3 tr\xE1nsito mar\xEDtimo hacia M\xE9xico",icon:"\u{1F6A2}"},ARRIVE_DEST:{title:"Arrib\xF3 a M\xE9xico",description:"Lleg\xF3 al puerto de destino",icon:"\u{1F3D7}\uFE0F"},CUSTOMS_CLEAR:{title:"En Proceso Aduanal",description:"Iniciado proceso de liberaci\xF3n",icon:"\u{1F4C4}"},RELEASE:{title:"Liberaci\xF3n Aduanal",description:"Liberada de aduanas exitosamente",icon:"\u{1F513}"},ARRIVE_WH:{title:"Lleg\xF3 a Bodega",description:"Arrib\xF3 a bodega local",icon:"\u{1F3EA}"},SCHEDULE_HANDOVER:{title:"Agendando Entrega",description:"Coordinando entrega con cliente",icon:"\u{1F4C5}"},CONFIRM_DELIVERY:{title:"Entrega Confirmada",description:"Cliente confirm\xF3 recepci\xF3n",icon:"\u{1F389}"}};var f=(()=>{class a{constructor(){this.http=E(R),this.baseUrl=window.__BFF_BASE__??"/api"}list(e){let t={};return e.market&&(t.market=e.market),e.routeId&&(t.routeId=e.routeId),e.clientId&&(t.clientId=e.clientId),e.cursor&&(t.cursor=e.cursor),e.limit&&(t.limit=e.limit.toString()),e.status&&e.status.length>0&&(t.status=e.status.join(",")),this.http.get(`${this.baseUrl}/v1/deliveries`,{params:t}).pipe(r(this.handleError("list deliveries")))}get(e){return this.http.get(`${this.baseUrl}/v1/deliveries/${e}`).pipe(r(this.handleError("get delivery")))}events(e){return this.http.get(`${this.baseUrl}/v1/deliveries/${e}/events`).pipe(r(this.handleError("get delivery events")))}transition(e,t){return this.http.post(`${this.baseUrl}/v1/deliveries/${e}/transition`,t).pipe(o(i=>(i.success&&!i.validationErrors?.length&&console.log(`Delivery ${e} transitioned via ${t.event} to ${i.newStatus}`),i)),r(this.handleError("transition delivery")))}getClientTracking(e){return this.http.get(`${this.baseUrl}/v1/deliveries/client/${e}`).pipe(o(t=>t.map(i=>this.transformToClientView(i))),r(this.handleError("get client tracking")))}create(e){return this.http.post(`${this.baseUrl}/v1/deliveries`,e).pipe(r(this.handleError("create delivery")))}getReadyForHandover(e){let t={status:"READY_FOR_HANDOVER"};return e&&(t.market=e),this.http.get(`${this.baseUrl}/v1/deliveries`,{params:t}).pipe(o(i=>i.items),r(this.handleError("get ready for handover")))}getStats(e,t){let i={};return e&&(i.market=e),t&&(i.routeId=t),this.http.get(`${this.baseUrl}/v1/deliveries/stats`,{params:i}).pipe(r(this.handleError("get delivery stats")))}scheduleHandover(e,t,i){return this.http.post(`${this.baseUrl}/v1/deliveries/${e}/schedule`,{scheduledDate:t,notes:i}).pipe(r(this.handleError("schedule handover")))}getRoutes(e){return this.http.get(`${this.baseUrl}/v1/routes`,{params:{market:e}}).pipe(r(this.handleError("get routes")))}canPerformTransition(e,t){return c(e).some(n=>n.event===t)}getAvailableActions(e,t){return c(e.status).filter(n=>n.requiredRole?n.requiredRole.includes(t):!0).map(n=>({event:n.event,label:this.getActionLabel(n.event),description:this.getActionDescription(n.event),requiresConfirmation:this.requiresConfirmation(n.event)}))}transformToClientView(e){let t=s[e.status];return{orderId:e.id,status:t.clientFriendly,estimatedDate:this.formatClientDate(e.eta),message:this.getClientMessage(e.status,e.eta),canScheduleHandover:e.status==="READY_FOR_HANDOVER",isDelivered:e.status==="DELIVERED"}}formatClientDate(e){if(!e)return"Fecha por confirmar";let t=new Date(e);return`${new Intl.DateTimeFormat("es-MX",{day:"numeric",month:"long"}).format(t)} (aproximadamente)`}getClientMessage(e,t){switch(e){case"PO_ISSUED":case"IN_PRODUCTION":case"READY_AT_FACTORY":return"Tu vagoneta se est\xE1 fabricando. Te notificaremos cuando est\xE9 lista.";case"AT_ORIGIN_PORT":case"ON_VESSEL":case"AT_DEST_PORT":case"IN_CUSTOMS":case"RELEASED":return`Tu vagoneta est\xE1 en camino. Llegar\xE1 ${this.formatClientDate(t)}.`;case"AT_WH":case"READY_FOR_HANDOVER":return"Tu vagoneta est\xE1 lista. Te contactaremos para coordinar la entrega.";case"DELIVERED":return"\xA1Tu vagoneta ha sido entregada exitosamente!";default:return"Procesando tu pedido..."}}getActionLabel(e){return{ISSUE_PO:"Emitir Orden",START_PROD:"Iniciar Producci\xF3n",FACTORY_READY:"Marcar Lista en F\xE1brica",LOAD_ORIGIN:"Cargar en Puerto",DEPART_VESSEL:"Confirmar Zarpe",ARRIVE_DEST:"Confirmar Arribo",CUSTOMS_CLEAR:"Iniciar Proceso Aduanal",RELEASE:"Confirmar Liberaci\xF3n",ARRIVE_WH:"Confirmar Llegada a Bodega",SCHEDULE_HANDOVER:"Agendar Entrega",CONFIRM_DELIVERY:"Confirmar Entrega"}[e]||e}getActionDescription(e){return{ISSUE_PO:"Enviar orden de compra a proveedor",START_PROD:"Comenzar proceso de fabricaci\xF3n",FACTORY_READY:"Producci\xF3n completada exitosamente",LOAD_ORIGIN:"Cargar en contenedor para embarque",DEPART_VESSEL:"Embarcaci\xF3n inici\xF3 tr\xE1nsito mar\xEDtimo",ARRIVE_DEST:"Arrib\xF3 al puerto de destino",CUSTOMS_CLEAR:"Iniciar tr\xE1mites de liberaci\xF3n aduanal",RELEASE:"Completar liberaci\xF3n de aduanas",ARRIVE_WH:"Confirmar llegada a bodega local",SCHEDULE_HANDOVER:"Coordinar entrega con cliente",CONFIRM_DELIVERY:"Cliente recibi\xF3 su vagoneta"}[e]||""}requiresConfirmation(e){return["ISSUE_PO","CONFIRM_DELIVERY","SCHEDULE_HANDOVER"].includes(e)}handleError(e){return t=>{console.error(`DeliveriesService.${e} failed:`,t);let i="Error en el servicio de entregas";return t.status===404?i="Pedido no encontrado":t.status===403?i="No tienes permisos para esta acci\xF3n":t.status===400?i=t.error?.message||"Solicitud inv\xE1lida":t.status===409?i="Transici\xF3n de estado no v\xE1lida":t.status>=500&&(i="Error del servidor. Intenta m\xE1s tarde"),d(()=>({operation:e,originalError:t,userMessage:i,timestamp:new Date().toISOString()}))}}canUserPerformAction(e,t){return e==="admin"||e==="ops"?!0:e==="advisor"?["SCHEDULE_HANDOVER","CONFIRM_DELIVERY"].includes(t):e==="client"?t==="CONFIRM_DELIVERY":!1}getStatusColor(e){return s[e]?.color||"#6b7280"}getStatusIcon(e){return s[e]?.icon||"\u{1F4E6}"}getDeliveryProgress(e){let t=["PO_ISSUED","IN_PRODUCTION","READY_AT_FACTORY","AT_ORIGIN_PORT","ON_VESSEL","AT_DEST_PORT","IN_CUSTOMS","RELEASED","AT_WH","READY_FOR_HANDOVER","DELIVERED"],i=t.indexOf(e);return i===-1?0:Math.round(i/(t.length-1)*100)}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{s as a,u as b,f as c};
