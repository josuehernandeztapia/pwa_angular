import{m as ee}from"./chunk-SCHFUJ5K.js";import{a as B,b as I,d as z,g as $,i as te,n as j,o as A,p as W,u as G}from"./chunk-S2UEMBMO.js";import{Ea as l,Fa as H,Sa as x,Ta as P,Ua as g,Va as S,Wa as O,Xb as V,Ya as o,Yb as N,Za as r,_a as k,bb as v,bc as D,cb as f,db as d,ea as T,eb as Q,f as J,fb as Z,gb as K,ib as c,jb as h,kb as M,ma as p,na as u,oa as F,ob as y,pa as U,pb as b,qb as w,sb as E}from"./chunk-5IDTUAMZ.js";import{a as L,b as q,g as X}from"./chunk-DM275RSA.js";var de=["flowCanvas"];function se(a,m){if(a&1&&(o(0,"div",44),c(1),r()),a&2){let e=m.$implicit;l(),M(" \u2022 ",e," ")}}function pe(a,m){if(a&1&&(o(0,"div",35)(1,"div",36)(2,"span",37),c(3,"\u{1F3D9}\uFE0F"),r(),o(4,"div",38)(5,"div",39),c(6),r(),o(7,"div",40),c(8),r()()(),o(9,"div",41)(10,"div",42),c(11,"\u26A0\uFE0F Restricciones:"),r(),x(12,se,2,1,"div",43),r()()),a&2){let e=d();l(6),h(e.getSelectedMarketName()),l(2),M("",e.getAvailableProductsForMarket().length," productos disponibles"),l(4),g("ngForOf",e.getMarketRestrictions(e.getSelectedMarketCode()))}}function ue(a,m){if(a&1&&(o(0,"div",58),c(1),r()),a&2){let e=d(3);l(),M(" \u274C No compatible con ",e.getSelectedMarketName()," ")}}function me(a,m){if(a&1){let e=v();o(0,"div",52),f("dragstart",function(t){let i=p(e).$implicit,s=d(2);return u(s.onDragStart(t,i))}),o(1,"div",53),c(2),r(),o(3,"div",54)(4,"div",55),c(5),r(),o(6,"div",56),c(7),r(),x(8,ue,2,1,"div",57),r()()}if(a&2){let e=m.$implicit,n=d(2);S("border-left-color",e.color),O("template-disabled",!n.isTemplateCompatible(e)),P("title",n.getTemplateTooltip(e)),l(2),h(e.icon),l(3),h(e.name),l(2),h(e.description),l(),g("ngIf",!n.isTemplateCompatible(e))}}function ge(a,m){if(a&1){let e=v();o(0,"div",45)(1,"div",46),f("click",function(){let t=p(e).$implicit,i=d();return u(i.toggleCategory(t.name))}),o(2,"span",47),c(3),r(),o(4,"span",48),c(5),r(),o(6,"span",49),c(7),r()(),o(8,"div",50),x(9,me,9,9,"div",51),r()()}if(a&2){let e=m.$implicit,n=d();l(3),h(e.expanded?"\u25BC":"\u25B6"),l(2),h(e.name),l(2),M("(",e.templates.length,")"),l(),O("expanded",e.expanded),l(),g("ngForOf",n.getFilteredTemplates(e.templates))}}function fe(a,m){if(a&1){let e=v();F(),o(0,"path",59),f("click",function(){let t=p(e).$implicit,i=d();return u(i.selectConnection(t))}),r()}if(a&2){let e=m.$implicit,n=d();O("connection-selected",(n.selectedConnection==null?null:n.selectedConnection.id)===e.id)("connection-invalid",e.isValid===!1),P("d",n.getConnectionPath(e))("title",e.validationMessage)}}function _e(a,m){if(a&1&&(F(),k(0,"path",60)),a&2){let e=d();P("d",e.tempConnection.path)}}function Ce(a,m){if(a&1){let e=v();o(0,"div",74)(1,"label",75)(2,"input",76),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.config.required,t)||(i.config.required=t),u(t)}),r(),o(3,"span"),c(4,"Obligatorio"),r()(),o(5,"label",75)(6,"input",76),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.config.ocrEnabled,t)||(i.config.ocrEnabled=t),u(t)}),r(),o(7,"span"),c(8,"OCR"),r()()()}if(a&2){let e=d().$implicit;l(2),y("ngModel",e.config.required),l(4),y("ngModel",e.config.ocrEnabled)}}function xe(a,m){if(a&1){let e=v();o(0,"div",77),f("mousedown",function(t){let i=p(e).$implicit,s=d().$implicit,C=d();return u(C.onPortMouseDown(t,s,i,"input"))}),k(1,"div",78),r()}if(a&2){let e=m.$implicit,n=d().$implicit;g("title",e.name),P("data-port-id",e.id)("data-node-id",n.id)}}function ve(a,m){if(a&1){let e=v();o(0,"div",79),f("mousedown",function(t){let i=p(e).$implicit,s=d().$implicit,C=d();return u(C.onPortMouseDown(t,s,i,"output"))}),k(1,"div",78),r()}if(a&2){let e=m.$implicit,n=d().$implicit;g("title",e.name),P("data-port-id",e.id)("data-node-id",n.id)}}function he(a,m){if(a&1){let e=v();o(0,"div",61),f("click",function(){let t=p(e).$implicit,i=d();return u(i.selectNode(t))})("mousedown",function(t){let i=p(e).$implicit,s=d();return u(s.onNodeMouseDown(t,i))}),o(1,"div",62)(2,"div",63),c(3),r(),o(4,"div",64),c(5),r(),o(6,"div",65)(7,"button",66),f("click",function(){let t=p(e).$implicit,i=d();return u(i.duplicateNode(t))}),c(8,"\u{1F4CB}"),r(),o(9,"button",66),f("click",function(){let t=p(e).$implicit,i=d();return u(i.deleteNode(t))}),c(10,"\u{1F5D1}\uFE0F"),r()()(),o(11,"div",67)(12,"div",68),c(13),r(),x(14,Ce,9,2,"div",69),r(),o(15,"div",70),x(16,xe,2,3,"div",71),r(),o(17,"div",72),x(18,ve,2,3,"div",73),r()()}if(a&2){let e=m.$implicit,n=d();S("left",e.position.x,"px")("top",e.position.y,"px")("border-color",e.color),O("node-selected",(n.selectedNode==null?null:n.selectedNode.id)===e.id),l(),S("background-color",e.color),l(2),h(e.icon),l(2),h(e.name),l(8),h(n.getNodeDescription(e)),l(),g("ngIf",e.type==="document"),l(2),g("ngForOf",e.inputs),l(2),g("ngForOf",e.outputs)}}function ye(a,m){if(a&1){let e=v();o(0,"div",84)(1,"label",85),c(2,"Tipo de Documento:"),r(),o(3,"select",88),w("ngModelChange",function(t){p(e);let i=d(3);return b(i.selectedNode.config.documentType,t)||(i.selectedNode.config.documentType=t),u(t)}),o(4,"option",89),c(5,"Identificaci\xF3n"),r(),o(6,"option",90),c(7,"Veh\xEDculo"),r(),o(8,"option",91),c(9,"Comprobante Domicilio"),r(),o(10,"option",92),c(11,"Financiero"),r(),o(12,"option",93),c(13,"Legal"),r(),o(14,"option",94),c(15,"Personalizado"),r()()()}if(a&2){let e=d(3);l(3),y("ngModel",e.selectedNode.config.documentType)}}function be(a,m){if(a&1){let e=v();o(0,"div",99)(1,"input",100),w("ngModelChange",function(t){let i=p(e).index,s=d(4);return b(s.selectedNode.config.regulations[i],t)||(s.selectedNode.config.regulations[i]=t),u(t)}),r(),o(2,"button",101),f("click",function(){let t=p(e).index,i=d(4);return u(i.removeRegulation(t))}),c(3,"\u2715"),r()()}if(a&2){let e=m.index,n=d(4);l(),y("ngModel",n.selectedNode.config.regulations[e])}}function we(a,m){if(a&1){let e=v();o(0,"div",84)(1,"label",85),c(2,"C\xF3digo de Ciudad:"),r(),o(3,"input",95),w("ngModelChange",function(t){p(e);let i=d(3);return b(i.selectedNode.config.cityCode,t)||(i.selectedNode.config.cityCode=t),u(t)}),r(),o(4,"label",85),c(5,"Regulaciones:"),r(),o(6,"div",96),x(7,be,4,1,"div",97),o(8,"button",98),f("click",function(){p(e);let t=d(3);return u(t.addRegulation())}),c(9,"+ Agregar"),r()()()}if(a&2){let e=d(3);l(3),y("ngModel",e.selectedNode.config.cityCode),l(4),g("ngForOf",e.selectedNode.config.regulations)}}function Me(a,m){if(a&1){let e=v();o(0,"div",84)(1,"label",85),c(2,"Tipo de Verificaci\xF3n:"),r(),o(3,"select",88),w("ngModelChange",function(t){p(e);let i=d(3);return b(i.selectedNode.config.verificationType,t)||(i.selectedNode.config.verificationType=t),u(t)}),o(4,"option",102),c(5,"Patr\xF3n de Voz"),r(),o(6,"option",103),c(7,"An\xE1lisis AVI"),r(),o(8,"option",104),c(9,"Biom\xE9trica"),r(),o(10,"option",105),c(11,"Documento"),r()()()}if(a&2){let e=d(3);l(3),y("ngModel",e.selectedNode.config.verificationType)}}function ke(a,m){if(a&1){let e=v();o(0,"div",83)(1,"h4"),c(2),r(),o(3,"div",84)(4,"label",85),c(5,"Nombre:"),r(),o(6,"input",86),w("ngModelChange",function(t){p(e);let i=d(2);return b(i.selectedNode.name,t)||(i.selectedNode.name=t),u(t)}),f("ngModelChange",function(){p(e);let t=d(2);return u(t.onNodePropertyChange())}),r()(),x(7,ye,16,1,"div",87)(8,we,10,2,"div",87)(9,Me,12,1,"div",87),r()}if(a&2){let e=d(2);l(2),M("\u{1F4E6} ",e.selectedNode.name,""),l(4),y("ngModel",e.selectedNode.name),l(),g("ngIf",e.selectedNode.type==="document"),l(),g("ngIf",e.selectedNode.type==="market"),l(),g("ngIf",e.selectedNode.type==="verification")}}function Pe(a,m){if(a&1){let e=v();o(0,"div",106)(1,"h4"),c(2,"\u{1F517} Conexi\xF3n"),r(),o(3,"div",84)(4,"label",85),c(5,"Condici\xF3n:"),r(),o(6,"select",88),w("ngModelChange",function(t){p(e);let i=d(2);return b(i.selectedConnection.condition,t)||(i.selectedConnection.condition=t),u(t)}),o(7,"option",107),c(8,"Siempre"),r(),o(9,"option",108),c(10,"En \xE9xito"),r(),o(11,"option",109),c(12,"En fallo"),r(),o(13,"option",94),c(14,"Personalizada"),r()()()()}if(a&2){let e=d(2);l(6),y("ngModel",e.selectedConnection.condition)}}function Oe(a,m){if(a&1&&(o(0,"div",80),x(1,ke,10,5,"div",81)(2,Pe,15,1,"div",82),r()),a&2){let e=d();l(),g("ngIf",e.selectedNode),l(),g("ngIf",e.selectedConnection)}}function Se(a,m){if(a&1&&(o(0,"div",118)(1,"div",119),k(2,"div",120),r(),o(3,"p",121),c(4),r()()),a&2){let e=d(2);l(2),S("width",e.generationProgress,"%"),l(2),h(e.generationStatus)}}function Te(a,m){if(a&1){let e=v();o(0,"button",126),f("click",function(){let t=p(e).$implicit,i=d(3);return u(i.activeCodeTab=t)}),c(1),r()}if(a&2){let e=m.$implicit,n=d(3);O("active",n.activeCodeTab===e),l(),M(" ",e," ")}}function Fe(a,m){if(a&1&&(o(0,"div",122)(1,"h4"),c(2,"\u{1F4CB} C\xF3digo Generado:"),r(),o(3,"div",123),x(4,Te,2,3,"button",124),r(),o(5,"div",125)(6,"pre")(7,"code"),c(8),r()()()()),a&2){let e=d(2);l(4),g("ngForOf",e.getGeneratedFiles()),l(4),h(e.getGeneratedCode(e.activeCodeTab))}}function Ee(a,m){if(a&1){let e=v();o(0,"div",110),f("click",function(){p(e);let t=d();return u(t.closeGenerationModal())}),o(1,"div",111),f("click",function(t){return p(e),u(t.stopPropagation())}),o(2,"div",112)(3,"h3"),c(4,"\u{1F680} Generar Flujo"),r(),o(5,"button",113),f("click",function(){p(e);let t=d();return u(t.closeGenerationModal())}),c(6,"\u2715"),r()(),o(7,"div",114),x(8,Se,5,3,"div",115)(9,Fe,9,2,"div",116),r(),o(10,"div",117)(11,"button",6),f("click",function(){p(e);let t=d();return u(t.closeGenerationModal())}),c(12,"Cancelar"),r(),o(13,"button",7),f("click",function(){p(e);let t=d();return u(t.downloadGeneratedCode())}),c(14," \u{1F4E5} Descargar C\xF3digo "),r()()()()}if(a&2){let e=d();l(8),g("ngIf",e.isGenerating),l(),g("ngIf",e.generatedCode&&!e.isGenerating),l(4),g("disabled",!e.generatedCode)}}var _=function(a){return a.Market="market",a.Document="document",a.Verification="verification",a.Product="product",a.BusinessRule="business-rule",a.Route="route",a}(_||{}),ne=(()=>{class a{constructor(){this.destroy$=new J,this.zoomLevel=1,this.panX=0,this.panY=0,this.canvasWidth=2e3,this.canvasHeight=2e3,this.selectedNode=null,this.selectedConnection=null,this.isDragging=!1,this.dragStartPos={x:0,y:0},this.draggedTemplate=null,this.tempConnection=null,this.connectionStart=null,this.searchTerm="",this.propertiesPanelExpanded=!0,this.showGenerationModal=!1,this.isGenerating=!1,this.generationProgress=0,this.generationStatus="",this.generatedCode={},this.activeCodeTab="",this.nodes=[],this.connections=[],this.nodeIdCounter=1,this.connectionIdCounter=1,this.marketCompatibilityMatrix=[{marketCode:"aguascalientes",marketName:"Aguascalientes",availableProducts:["venta_directa","venta_plazo","ahorro_programado"],restrictions:["No cr\xE9dito colectivo","No tanda colectiva","SEMOV obligatorio"],isComplexMarket:!1},{marketCode:"edomex",marketName:"Estado de M\xE9xico",availableProducts:["venta_directa","venta_plazo","ahorro_programado","credito_colectivo","tanda_colectiva"],restrictions:["Verificaci\xF3n vehicular obligatoria","L\xEDmites de riesgo por municipio","AVI + Voice Pattern para productos complejos"],isComplexMarket:!0,regulatoryInheritance:"master"},{marketCode:"guadalajara",marketName:"Guadalajara",availableProducts:["venta_directa","venta_plazo","ahorro_programado","credito_colectivo"],restrictions:["No tanda colectiva","Regulaci\xF3n SEMOV especial","\u26A0\uFE0F Hereda regulaciones EdoMex para Cr\xE9dito Colectivo"],isComplexMarket:!0,regulatoryInheritance:"edomex"},{marketCode:"cdmx",marketName:"Ciudad de M\xE9xico",availableProducts:["venta_directa","venta_plazo","ahorro_programado"],restrictions:["Verificaci\xF3n obligatoria","No productos colectivos"],isComplexMarket:!1},{marketCode:"monterrey",marketName:"Monterrey",availableProducts:["venta_directa","venta_plazo","ahorro_programado","credito_colectivo"],restrictions:["Regulaci\xF3n estatal NL","\u26A0\uFE0F Hereda regulaciones EdoMex para Cr\xE9dito Colectivo"],isComplexMarket:!0,regulatoryInheritance:"edomex"}],this.nodeTemplates=[{type:_.Market,name:"Ciudad/Mercado",icon:"\u{1F3D9}\uFE0F",color:"#3b82f6",category:"\u{1F30D} Mercados",description:"Define una nueva ciudad o mercado",defaultConfig:{cityCode:"",name:"",regulations:["Regulaci\xF3n 1"],timezone:"America/Mexico_City",language:"es-MX"},inputs:[],outputs:[{name:"Flujo",type:"output",dataType:"flow"}]},{type:_.Document,name:"INE Vigente",icon:"\u{1F194}",color:"#10b981",category:"\u{1F4C4} Documentos",description:"Documento de identificaci\xF3n oficial",defaultConfig:{documentType:"identification",required:!0,ocrEnabled:!0,validationRules:["must_be_valid","not_expired"]},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Aprobado",type:"output",dataType:"flow"},{name:"Rechazado",type:"output",dataType:"flow"}]},{type:_.Document,name:"Tarjeta de Circulaci\xF3n",icon:"\u{1F697}",color:"#10b981",category:"\u{1F4C4} Documentos",description:"Documento del veh\xEDculo",defaultConfig:{documentType:"vehicle",required:!0,ocrEnabled:!0,extractFields:["placas","marca","modelo","a\xF1o"]},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Aprobado",type:"output",dataType:"flow"},{name:"Rechazado",type:"output",dataType:"flow"}]},{type:_.Document,name:"Documento Personalizado",icon:"\u{1F4CB}",color:"#10b981",category:"\u{1F4C4} Documentos",description:"Documento espec\xEDfico de la ciudad",defaultConfig:{documentType:"custom",name:"Documento Personalizado",required:!0,ocrEnabled:!1},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Aprobado",type:"output",dataType:"flow"},{name:"Rechazado",type:"output",dataType:"flow"}]},{type:_.Verification,name:"Patr\xF3n de Voz",icon:"\u{1F3A4}",color:"#f59e0b",category:"\u{1F50D} Verificaciones",description:"Verificaci\xF3n por patr\xF3n de voz",defaultConfig:{verificationType:"voice",duration:"2-3 min",required:!0},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Verificado",type:"output",dataType:"flow"},{name:"Fallido",type:"output",dataType:"flow"}]},{type:_.Verification,name:"An\xE1lisis AVI",icon:"\u{1F916}",color:"#f59e0b",category:"\u{1F50D} Verificaciones",description:"An\xE1lisis autom\xE1tico de voz e inteligencia",defaultConfig:{verificationType:"avi",duration:"15-20 min",questions:12,required:!0},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Aprobado",type:"output",dataType:"flow"},{name:"Rechazado",type:"output",dataType:"flow"}]},{type:_.Product,name:"Venta Directa",icon:"\u{1F4B0}",color:"#8b5cf6",category:"\u{1F4BC} Productos",description:"Producto de venta directa simplificado",defaultConfig:{productType:"venta_directa",complexity:"simple",requiresVerification:!1},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Contrato",type:"output",dataType:"flow"}],compatibleWith:["aguascalientes","edomex","guadalajara","cdmx"]},{type:_.Product,name:"Venta a Plazo",icon:"\u{1F3E6}",color:"#8b5cf6",category:"\u{1F4BC} Productos",description:"Producto de financiamiento completo",defaultConfig:{productType:"venta_plazo",complexity:"complex",requiresVerification:!0},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Contrato",type:"output",dataType:"flow"}],compatibleWith:["aguascalientes","edomex","guadalajara","cdmx"]},{type:_.Product,name:"Ahorro Programado",icon:"\u{1F437}",color:"#8b5cf6",category:"\u{1F4BC} Productos",description:"Plan de ahorro para veh\xEDculo",defaultConfig:{productType:"ahorro_programado",complexity:"medium",requiresVerification:!1},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Contrato",type:"output",dataType:"flow"}],compatibleWith:["aguascalientes","edomex","guadalajara","cdmx"]},{type:_.Product,name:"Cr\xE9dito Colectivo",icon:"\u{1F465}",color:"#8b5cf6",category:"\u{1F4BC} Productos",description:"Cr\xE9dito grupal para veh\xEDculos",defaultConfig:{productType:"credito_colectivo",complexity:"complex",requiresVerification:!0,minMembers:5,maxMembers:50},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Contrato",type:"output",dataType:"flow"}],compatibleWith:["edomex","guadalajara"]},{type:_.Product,name:"Tanda Colectiva",icon:"\u{1F504}",color:"#8b5cf6",category:"\u{1F4BC} Productos",description:"Sistema de tanda para ahorro grupal",defaultConfig:{productType:"tanda_colectiva",complexity:"complex",requiresVerification:!0,participants:12},inputs:[{name:"Entrada",type:"input",dataType:"flow"}],outputs:[{name:"Contrato",type:"output",dataType:"flow"}],compatibleWith:["edomex"]}]}ngOnInit(){this.loadSampleFlow()}getGeneratedFiles(){return Object.keys(this.generatedCode||{})}getGeneratedCode(e){return this.generatedCode&&this.generatedCode[e]||""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getFilteredCategories(){let e={};return this.nodeTemplates.filter(t=>!this.searchTerm||t.name.toLowerCase().includes(this.searchTerm.toLowerCase())||t.description.toLowerCase().includes(this.searchTerm.toLowerCase())).forEach(t=>{e[t.category]||(e[t.category]={name:t.category,expanded:!0,templates:[]}),e[t.category].templates.push(t)}),Object.values(e)}toggleCategory(e){let t=this.getFilteredCategories().find(i=>i.name===e);t&&(t.expanded=!t.expanded)}onDragStart(e,n){this.draggedTemplate=n,e.dataTransfer&&(e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("application/json",JSON.stringify(n)))}onDragOver(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}onDrop(e){if(e.preventDefault(),!this.draggedTemplate)return;let n=this.flowCanvas.nativeElement.getBoundingClientRect(),t=(e.clientX-n.left-this.panX)/this.zoomLevel,i=(e.clientY-n.top-this.panY)/this.zoomLevel;this.createNodeFromTemplate(this.draggedTemplate,{x:t,y:i}),this.draggedTemplate=null}createNodeFromTemplate(e,n){if(e.type===_.Product&&!this.isTemplateCompatible(e)){let i=this.getSelectedMarketName();console.warn(`Cannot create ${e.name}: not compatible with ${i}`);return}let t={id:`node_${this.nodeIdCounter++}`,type:e.type,name:e.name,icon:e.icon,color:e.color,position:n,config:JSON.parse(JSON.stringify(e.defaultConfig)),inputs:e.inputs.map((i,s)=>q(L({},i),{id:`input_${t.id}_${s}`})),outputs:e.outputs.map((i,s)=>q(L({},i),{id:`output_${t.id}_${s}`}))};this.nodes.push(t),this.validateAllConnections()}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.2,3)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.2,.2)}fitToView(){this.zoomLevel=1,this.panX=0,this.panY=0}centerView(){this.panX=0,this.panY=0}selectNode(e){this.selectedNode=e,this.selectedConnection=null}duplicateNode(e){let n=JSON.parse(JSON.stringify(e));n.id=`node_${this.nodeIdCounter++}`,n.position.x+=50,n.position.y+=50,n.isSelected=!1,this.nodes.push(n)}deleteNode(e){this.connections=this.connections.filter(n=>n.sourceNodeId!==e.id&&n.targetNodeId!==e.id),this.nodes=this.nodes.filter(n=>n.id!==e.id),this.selectedNode?.id===e.id&&(this.selectedNode=null)}getNodeDescription(e){switch(e.type){case _.Market:return`Ciudad: ${e.config.cityCode||"Sin configurar"}`;case _.Document:return`${e.config.required?"Obligatorio":"Opcional"} | ${e.config.ocrEnabled?"OCR":"Manual"}`;case _.Verification:return`${e.config.verificationType} | ${e.config.duration||"N/A"}`;case _.Product:return`${e.config.complexity} | ${e.config.requiresVerification?"Con verificaci\xF3n":"Sin verificaci\xF3n"}`;default:return"Nodo personalizado"}}getConnectionPath(e){let n=this.nodes.find(R=>R.id===e.sourceNodeId),t=this.nodes.find(R=>R.id===e.targetNodeId);if(!n||!t)return"";let i=n.position.x+200,s=n.position.y+50,C=t.position.x,Y=t.position.y+50,ie=i+(C-i)*.5,oe=s,re=C-(C-i)*.5;return`M ${i} ${s} C ${ie} ${oe}, ${re} ${Y}, ${C} ${Y}`}selectConnection(e){this.selectedConnection=e,this.selectedNode=null}trackConnection(e,n){return n.id}trackNode(e,n){return n.id}onCanvasMouseDown(e){e.target===this.flowCanvas.nativeElement&&(this.selectedNode=null,this.selectedConnection=null)}onCanvasMouseMove(e){}onCanvasMouseUp(e){}onNodeMouseDown(e,n){e.stopPropagation(),this.selectNode(n)}onPortMouseDown(e,n,t,i){e.stopPropagation()}togglePropertiesPanel(){this.propertiesPanelExpanded=!this.propertiesPanelExpanded}onNodePropertyChange(){}addRegulation(){this.selectedNode?.config.regulations&&this.selectedNode.config.regulations.push("")}removeRegulation(e){this.selectedNode?.config.regulations&&this.selectedNode.config.regulations.splice(e,1)}get canDeploy(){return this.nodes.length>0}clearFlow(){this.nodes=[],this.connections=[],this.selectedNode=null,this.selectedConnection=null}saveFlow(){let e={nodes:this.nodes,connections:this.connections,version:"1.0"};localStorage.setItem("flow_builder_data",JSON.stringify(e)),console.log("Flow saved:",e)}deployFlow(){this.showGenerationModal=!0,this.generateCode()}closeGenerationModal(){this.showGenerationModal=!1,this.generatedCode={},this.activeCodeTab=""}downloadGeneratedCode(){Object.entries(this.generatedCode).forEach(([e,n])=>{let t=new Blob([n],{type:"text/plain"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i)})}generateCode(){return X(this,null,function*(){this.isGenerating=!0,this.generationProgress=0,this.generationStatus="Analizando flujo...",yield this.delay(500),this.generationProgress=25,this.generationStatus="Generando componentes...",yield this.delay(500),this.generationProgress=50,this.generationStatus="Creando rutas...",yield this.delay(500),this.generationProgress=75,this.generationStatus="Generando servicios...",yield this.delay(500),this.generationProgress=100,this.generationStatus="Completado",this.generatedCode=this.createGeneratedCode(),this.activeCodeTab=Object.keys(this.generatedCode)[0]||"",this.isGenerating=!1})}createGeneratedCode(){let e=this.nodes.filter(s=>s.type===_.Market),n=this.nodes.filter(s=>s.type===_.Document),t=this.nodes.filter(s=>s.type===_.Product),i={};if(e.length>0){let s=e[0].config.cityCode;i[`${s}-routes.ts`]=this.generateRouteCode(s,t)}return n.length>0&&(i["document-requirements.service.ts"]=this.generateDocumentService(n)),t.forEach(s=>{let C=s.config.productType.replace("_","-");i[`${C}.component.ts`]=this.generateComponentCode(s)}),i}generateRouteCode(e,n){let t=n.map(i=>{let s=i.config.productType.replace("_","-");return`  {
    path: '${s}',
    loadComponent: () => import('./components/${s}/${s}.component').then(c => c.${this.toPascalCase(s)}Component),
    title: '${i.name} - ${e.toUpperCase()}'
  }`}).join(`,
`);return`// Generated routes for ${e}
export const ${e}Routes = [
${t}
];`}generateDocumentService(e){return`// Generated document requirements
export const GENERATED_DOCUMENTS = [
${e.map(t=>`  {
    id: '${t.id}',
    name: '${t.name}',
    type: '${t.config.documentType}',
    required: ${t.config.required},
    ocrEnabled: ${t.config.ocrEnabled}
  }`).join(`,
`)}
];`}generateComponentCode(e){let n=this.toPascalCase(e.config.productType.replace("_","-"));return`// Generated component for ${e.name}
@Component({
  selector: 'app-${e.config.productType.replace("_","-")}',
  template: \`
    <div class="product-container">
      <h2>${e.name}</h2>
      <p>Generated component for ${e.name}</p>
    </div>
  \`
})
export class ${n}Component {
  // Generated implementation
}`}toPascalCase(e){return e.split("-").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join("")}delay(e){return new Promise(n=>setTimeout(n,e))}validateConnection(e,n){if(e.type===_.Market&&n.type===_.Product){let t=e.config.cityCode,i=n.config.productType,s=this.marketCompatibilityMatrix.find(C=>C.marketCode===t);if(!s)return{isValid:!1,message:`Ciudad ${t} no configurada`};if(!s.availableProducts.includes(i))return{isValid:!1,message:`\u274C ${{credito_colectivo:"Cr\xE9dito Colectivo",tanda_colectiva:"Tanda Colectiva",venta_directa:"Venta Directa",venta_plazo:"Venta a Plazo",ahorro_programado:"Ahorro Programado"}[i]} no disponible en ${s.marketName}`}}return{isValid:!0}}getFilteredProductTemplates(e){if(!e)return this.nodeTemplates.filter(t=>t.type===_.Product);let n=this.marketCompatibilityMatrix.find(t=>t.marketCode===e);return n?this.nodeTemplates.filter(t=>{if(t.type!==_.Product)return!1;let i=t.defaultConfig.productType;return n.availableProducts.includes(i)}):this.nodeTemplates.filter(t=>t.type===_.Product)}getMarketRestrictions(e){return this.marketCompatibilityMatrix.find(t=>t.marketCode===e)?.restrictions||[]}validateAllConnections(){this.connections.forEach(e=>{let n=this.nodes.find(i=>i.id===e.sourceNodeId),t=this.nodes.find(i=>i.id===e.targetNodeId);if(n&&t){let i=this.validateConnection(n,t);e.isValid=i.isValid,e.validationMessage=i.message}})}getAvailableProductsForMarket(){let e=this.nodes.filter(i=>i.type===_.Market);if(e.length===0)return[];let n=e[0];return this.marketCompatibilityMatrix.find(i=>i.marketCode===n.config.cityCode)?.availableProducts||[]}getSelectedMarketCode(){let e=this.nodes.filter(n=>n.type===_.Market);return e.length>0?e[0].config.cityCode:""}getSelectedMarketName(){let e=this.getSelectedMarketCode();return this.marketCompatibilityMatrix.find(t=>t.marketCode===e)?.marketName||e}getFilteredTemplates(e){return e}isTemplateCompatible(e){if(e.type!==_.Product)return!0;let n=this.getSelectedMarketCode();if(!n)return!0;let t=e.defaultConfig.productType;return this.marketCompatibilityMatrix.find(s=>s.marketCode===n)?.availableProducts.includes(t)||!1}getTemplateTooltip(e){if(e.type!==_.Product)return e.description;let n=this.getSelectedMarketCode();if(!n)return e.description;let t=this.marketCompatibilityMatrix.find(s=>s.marketCode===n),i=e.defaultConfig.productType;if(this.isTemplateCompatible(e)){let s=`${e.description} - Compatible con ${this.getSelectedMarketName()}`;return this.isComplexProduct(i)&&t?.isComplexMarket&&(s+=" [Mercado Complejo - Requiere AVI + Voice Pattern]",t.regulatoryInheritance==="edomex"&&(s+=" [Hereda regulaciones EdoMex]")),s}else return`${e.description} - No disponible en ${this.getSelectedMarketName()}`}isComplexProduct(e){return["credito_colectivo","tanda_colectiva"].includes(e)}getRegulatoryFramework(e){let n=this.marketCompatibilityMatrix.find(t=>t.marketCode===e);return n?n.regulatoryInheritance==="master"?"edomex_master":n.regulatoryInheritance==="edomex"?"edomex_inherited":n.isComplexMarket?"complex_custom":"simple":"unknown"}getRequiredVerificationFlow(e,n){let t=this.getRegulatoryFramework(e),i=this.isComplexProduct(n),s=["documents"];return i&&(t.includes("edomex")||t==="complex_custom")&&(s.push("voice_pattern"),s.push("avi_analysis")),s}loadSampleFlow(){let e=[{id:"market_1",type:_.Market,name:"Guadalajara",icon:"\u{1F3D9}\uFE0F",color:"#3b82f6",position:{x:50,y:100},config:{cityCode:"guadalajara",name:"Guadalajara",regulations:["SEMOV","Verificaci\xF3n Vehicular"],timezone:"America/Mexico_City",language:"es-MX"},inputs:[],outputs:[{id:"output_market_1_0",name:"Flujo",type:"output",dataType:"flow"}]},{id:"doc_1",type:_.Document,name:"INE Vigente",icon:"\u{1F194}",color:"#10b981",position:{x:350,y:50},config:{documentType:"identification",required:!0,ocrEnabled:!0,validationRules:["must_be_valid","not_expired"]},inputs:[{id:"input_doc_1_0",name:"Entrada",type:"input",dataType:"flow"}],outputs:[{id:"output_doc_1_0",name:"Aprobado",type:"output",dataType:"flow"},{id:"output_doc_1_1",name:"Rechazado",type:"output",dataType:"flow"}]},{id:"product_1",type:_.Product,name:"Venta Directa",icon:"\u{1F4B0}",color:"#8b5cf6",position:{x:650,y:100},config:{productType:"venta_directa",complexity:"simple",requiresVerification:!1},inputs:[{id:"input_product_1_0",name:"Entrada",type:"input",dataType:"flow"}],outputs:[{id:"output_product_1_0",name:"Contrato",type:"output",dataType:"flow"}]}];this.nodes=e,this.nodeIdCounter=4}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275cmp=T({type:a,selectors:[["app-flow-builder"]],viewQuery:function(n,t){if(n&1&&Q(de,5),n&2){let i;Z(i=K())&&(t.flowCanvas=i.first)}},standalone:!0,features:[E],decls:55,vars:18,consts:[["flowCanvas",""],[1,"flow-builder-container"],[1,"flow-builder-header"],[1,"header-left"],[1,"subtitle"],[1,"header-right"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"flow-builder-content"],[1,"nodes-palette"],[1,"palette-header"],["type","text","placeholder","Buscar nodos...",1,"search-input",3,"ngModelChange","ngModel"],[1,"palette-content"],["class","market-info-panel",4,"ngIf"],["class","node-category",4,"ngFor","ngForOf"],[1,"flow-canvas-container"],[1,"canvas-toolbar"],[1,"zoom-controls"],[1,"zoom-btn",3,"click"],[1,"zoom-level"],[1,"canvas-controls"],[1,"canvas-btn",3,"click"],[1,"flow-canvas",3,"drop","dragover","mousedown","mousemove","mouseup"],[1,"connections-layer"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","10","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7","fill","#6B7280"],["class","connection-line","marker-end","url(#arrowhead)",3,"connection-selected","connection-invalid","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","connection-temp","marker-end","url(#arrowhead)",4,"ngIf"],[1,"nodes-layer"],["class","flow-node",3,"node-selected","left","top","border-color","click","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[1,"properties-panel"],[1,"panel-header"],[1,"panel-toggle",3,"click"],["class","panel-content",4,"ngIf"],["class","flow-modal",3,"click",4,"ngIf"],[1,"market-info-panel"],[1,"market-info-header"],[1,"market-icon"],[1,"market-details"],[1,"market-name"],[1,"market-products"],[1,"market-restrictions"],[1,"restrictions-title"],["class","restriction-item",4,"ngFor","ngForOf"],[1,"restriction-item"],[1,"node-category"],[1,"category-header",3,"click"],[1,"category-icon"],[1,"category-name"],[1,"category-count"],[1,"category-content"],["class","node-template","draggable","true",3,"border-left-color","template-disabled","dragstart",4,"ngFor","ngForOf"],["draggable","true",1,"node-template",3,"dragstart"],[1,"template-icon"],[1,"template-info"],[1,"template-name"],[1,"template-description"],["class","template-warning",4,"ngIf"],[1,"template-warning"],["marker-end","url(#arrowhead)",1,"connection-line",3,"click"],["marker-end","url(#arrowhead)",1,"connection-temp"],[1,"flow-node",3,"click","mousedown"],[1,"node-header"],[1,"node-icon"],[1,"node-name"],[1,"node-actions"],[1,"node-action-btn",3,"click"],[1,"node-content"],[1,"node-description"],["class","node-quick-config",4,"ngIf"],[1,"node-ports","inputs"],["class","node-port input-port",3,"title","mousedown",4,"ngFor","ngForOf"],[1,"node-ports","outputs"],["class","node-port output-port",3,"title","mousedown",4,"ngFor","ngForOf"],[1,"node-quick-config"],[1,"config-checkbox"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"node-port","input-port",3,"mousedown","title"],[1,"port-connector"],[1,"node-port","output-port",3,"mousedown","title"],[1,"panel-content"],["class","node-properties",4,"ngIf"],["class","connection-properties",4,"ngIf"],[1,"node-properties"],[1,"property-group"],[1,"property-label"],["type","text",1,"property-input",3,"ngModelChange","ngModel"],["class","property-group",4,"ngIf"],[1,"property-select",3,"ngModelChange","ngModel"],["value","identification"],["value","vehicle"],["value","address"],["value","financial"],["value","legal"],["value","custom"],["type","text","placeholder","guadalajara",1,"property-input",3,"ngModelChange","ngModel"],[1,"regulations-list"],["class","regulation-item",4,"ngFor","ngForOf"],[1,"add-regulation-btn",3,"click"],[1,"regulation-item"],["type","text","placeholder","SEMOV, Verificaci\xF3n...",1,"regulation-input",3,"ngModelChange","ngModel"],[1,"remove-btn",3,"click"],["value","voice"],["value","avi"],["value","biometric"],["value","document"],[1,"connection-properties"],["value","always"],["value","success"],["value","failure"],[1,"flow-modal",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[1,"modal-body"],["class","generation-progress",4,"ngIf"],["class","generation-preview",4,"ngIf"],[1,"modal-actions"],[1,"generation-progress"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"generation-preview"],[1,"code-tabs"],["class","code-tab",3,"active","click",4,"ngFor","ngForOf"],[1,"code-content"],[1,"code-tab",3,"click"]],template:function(n,t){if(n&1){let i=v();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),c(4,"\u{1F3A8} Flow Builder"),r(),o(5,"span",4),c(6,"Crear ciudad/flujo visualmente"),r()(),o(7,"div",5)(8,"button",6),f("click",function(){return p(i),u(t.clearFlow())}),c(9,"\u{1F5D1}\uFE0F Limpiar"),r(),o(10,"button",6),f("click",function(){return p(i),u(t.saveFlow())}),c(11,"\u{1F4BE} Guardar"),r(),o(12,"button",7),f("click",function(){return p(i),u(t.deployFlow())}),c(13,"\u{1F680} Deploy"),r()()(),o(14,"div",8)(15,"div",9)(16,"div",10)(17,"h3"),c(18,"\u{1F4E6} Componentes"),r(),o(19,"input",11),w("ngModelChange",function(C){return p(i),b(t.searchTerm,C)||(t.searchTerm=C),u(C)}),r()(),o(20,"div",12),x(21,pe,13,3,"div",13)(22,ge,10,6,"div",14),r()(),o(23,"div",15)(24,"div",16)(25,"div",17)(26,"button",18),f("click",function(){return p(i),u(t.zoomOut())}),c(27,"\u2796"),r(),o(28,"span",19),c(29),r(),o(30,"button",18),f("click",function(){return p(i),u(t.zoomIn())}),c(31,"\u2795"),r()(),o(32,"div",20)(33,"button",21),f("click",function(){return p(i),u(t.fitToView())}),c(34,"\u{1F3AF} Ajustar"),r(),o(35,"button",21),f("click",function(){return p(i),u(t.centerView())}),c(36,"\u{1F4D0} Centrar"),r()()(),o(37,"div",22,0),f("drop",function(C){return p(i),u(t.onDrop(C))})("dragover",function(C){return p(i),u(t.onDragOver(C))})("mousedown",function(C){return p(i),u(t.onCanvasMouseDown(C))})("mousemove",function(C){return p(i),u(t.onCanvasMouseMove(C))})("mouseup",function(C){return p(i),u(t.onCanvasMouseUp(C))}),F(),o(39,"svg",23)(40,"defs")(41,"marker",24),k(42,"polygon",25),r()(),x(43,fe,1,6,"path",26)(44,_e,1,1,"path",27),r(),U(),o(45,"div",28),x(46,he,19,16,"div",29),r()()(),o(47,"div",30)(48,"div",31)(49,"h3"),c(50,"\u2699\uFE0F Propiedades"),r(),o(51,"button",32),f("click",function(){return p(i),u(t.togglePropertiesPanel())}),c(52),r()(),x(53,Oe,3,2,"div",33),r()(),x(54,Ee,15,3,"div",34),r()}n&2&&(l(12),g("disabled",!t.canDeploy),l(7),y("ngModel",t.searchTerm),l(2),g("ngIf",t.getSelectedMarketCode()),l(),g("ngForOf",t.getFilteredCategories()),l(7),M("",(t.zoomLevel*100).toFixed(0),"%"),l(8),S("transform","scale("+t.zoomLevel+") translate("+t.panX+"px, "+t.panY+"px)"),l(2),P("viewBox","0 0 "+t.canvasWidth+" "+t.canvasHeight),l(4),g("ngForOf",t.connections)("ngForTrackBy",t.trackConnection),l(),g("ngIf",t.tempConnection),l(2),g("ngForOf",t.nodes)("ngForTrackBy",t.trackNode),l(),O("panel-collapsed",!t.selectedNode&&!t.selectedConnection),l(5),M(" ",t.propertiesPanelExpanded?"\u2192":"\u2190"," "),l(),g("ngIf",t.selectedNode||t.selectedConnection),l(),g("ngIf",t.showGenerationModal))},dependencies:[D,V,N,G,A,W,I,B,j,z,$],styles:[".flow-builder-container[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column;background:#f8fafc;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.flow-builder-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:#fff;border-bottom:1px solid #e2e8f0;box-shadow:0 1px 3px #0000001a}.header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700;color:#1e293b}.subtitle[_ngcontent-%COMP%]{color:#64748b;font-size:14px;margin-left:12px}.header-right[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:8px 16px;border-radius:8px;font-weight:500;cursor:pointer;transition:all .2s;border:none;font-size:14px}.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.btn-primary[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.flow-builder-content[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}.nodes-palette[_ngcontent-%COMP%]{width:300px;background:#fff;border-right:1px solid #e2e8f0;display:flex;flex-direction:column}.palette-header[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #e2e8f0}.palette-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;font-size:16px;font-weight:600;color:#1e293b}.search-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px}.palette-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.node-category[_ngcontent-%COMP%]{border-bottom:1px solid #f1f5f9}.category-header[_ngcontent-%COMP%]{padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:500;color:#374151;transition:background .2s}.category-header[_ngcontent-%COMP%]:hover{background:#f8fafc}.category-icon[_ngcontent-%COMP%]{color:#6b7280;font-size:12px}.category-count[_ngcontent-%COMP%]{color:#9ca3af;font-size:12px;margin-left:auto}.category-content[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:max-height .3s ease}.category-content.expanded[_ngcontent-%COMP%]{max-height:500px}.node-template[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 24px;cursor:grab;border-left:3px solid transparent;transition:all .2s}.node-template[_ngcontent-%COMP%]:hover{background:#f8fafc;border-left-color:currentColor!important}.node-template[_ngcontent-%COMP%]:active{cursor:grabbing}.template-icon[_ngcontent-%COMP%]{font-size:18px;width:24px;text-align:center}.template-info[_ngcontent-%COMP%]{flex:1}.template-name[_ngcontent-%COMP%]{font-weight:500;color:#374151;font-size:14px}.template-description[_ngcontent-%COMP%]{color:#6b7280;font-size:12px;margin-top:2px}.template-disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed!important;background:#f8fafc}.template-warning[_ngcontent-%COMP%]{color:#ef4444;font-size:10px;font-weight:500;margin-top:4px}.market-info-panel[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:12px;margin-bottom:16px}.market-info-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.market-icon[_ngcontent-%COMP%]{font-size:16px}.market-name[_ngcontent-%COMP%]{font-weight:600;color:#374151;font-size:14px}.market-products[_ngcontent-%COMP%]{color:#6b7280;font-size:11px}.market-restrictions[_ngcontent-%COMP%]{border-top:1px solid #e2e8f0;padding-top:8px}.restrictions-title[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#f59e0b;margin-bottom:4px}.restriction-item[_ngcontent-%COMP%]{font-size:10px;color:#6b7280;line-height:1.3}.flow-canvas-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden}.canvas-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;background:#fff;border-bottom:1px solid #e2e8f0}.zoom-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.zoom-btn[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid #e2e8f0;background:#fff;border-radius:4px;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center}.zoom-level[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;min-width:40px;text-align:center}.canvas-controls[_ngcontent-%COMP%]{display:flex;gap:8px}.canvas-btn[_ngcontent-%COMP%]{padding:6px 12px;border:1px solid #e2e8f0;background:#fff;border-radius:4px;cursor:pointer;font-size:12px;color:#6b7280}.flow-canvas[_ngcontent-%COMP%]{flex:1;position:relative;background:radial-gradient(circle,#e2e8f0 1px,transparent 1px);background-size:20px 20px;cursor:grab;transform-origin:0 0;transition:transform .2s ease}.flow-canvas.dragging[_ngcontent-%COMP%]{cursor:grabbing}.connections-layer[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}.connection-line[_ngcontent-%COMP%]{fill:none;stroke:#6b7280;stroke-width:2;pointer-events:stroke;cursor:pointer}.connection-line[_ngcontent-%COMP%]:hover, .connection-selected[_ngcontent-%COMP%]{stroke:#3b82f6;stroke-width:3}.connection-temp[_ngcontent-%COMP%]{fill:none;stroke:#94a3b8;stroke-width:2;stroke-dasharray:5,5}.connection-invalid[_ngcontent-%COMP%]{stroke:#ef4444!important;stroke-width:3;stroke-dasharray:8,4;animation:_ngcontent-%COMP%_pulse-error 2s infinite}@keyframes _ngcontent-%COMP%_pulse-error{0%,to{opacity:1}50%{opacity:.6}}.nodes-layer[_ngcontent-%COMP%]{position:relative;z-index:2}.flow-node[_ngcontent-%COMP%]{position:absolute;background:#fff;border:2px solid #e2e8f0;border-radius:8px;min-width:200px;cursor:pointer;box-shadow:0 2px 8px #0000001a;transition:all .2s}.flow-node[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026;transform:translateY(-1px)}.flow-node.node-selected[_ngcontent-%COMP%]{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.node-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#fff;font-weight:500;font-size:14px;border-radius:6px 6px 0 0}.node-name[_ngcontent-%COMP%]{flex:1}.node-actions[_ngcontent-%COMP%]{display:flex;gap:4px;opacity:0;transition:opacity .2s}.flow-node[_ngcontent-%COMP%]:hover   .node-actions[_ngcontent-%COMP%]{opacity:1}.node-action-btn[_ngcontent-%COMP%]{background:#fff3;border:none;color:#fff;width:20px;height:20px;border-radius:3px;cursor:pointer;font-size:10px}.node-content[_ngcontent-%COMP%]{padding:12px}.node-description[_ngcontent-%COMP%]{color:#6b7280;font-size:12px;margin-bottom:8px}.node-quick-config[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.config-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;color:#6b7280}.node-ports[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%)}.node-ports.inputs[_ngcontent-%COMP%]{left:-6px}.node-ports.outputs[_ngcontent-%COMP%]{right:-6px}.node-port[_ngcontent-%COMP%]{position:relative;margin:8px 0}.port-connector[_ngcontent-%COMP%]{width:12px;height:12px;border:2px solid #6b7280;background:#fff;border-radius:50%;cursor:crosshair;transition:all .2s}.port-connector[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background:#3b82f6;transform:scale(1.2)}.properties-panel[_ngcontent-%COMP%]{width:320px;background:#fff;border-left:1px solid #e2e8f0;display:flex;flex-direction:column;transition:width .3s ease}.properties-panel.panel-collapsed[_ngcontent-%COMP%]{width:0;overflow:hidden}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e2e8f0}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#1e293b}.panel-toggle[_ngcontent-%COMP%]{background:none;border:none;color:#6b7280;cursor:pointer;font-size:16px}.panel-content[_ngcontent-%COMP%]{flex:1;padding:16px;overflow-y:auto}.property-group[_ngcontent-%COMP%]{margin-bottom:16px}.property-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:500;color:#374151;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}.property-input[_ngcontent-%COMP%], .property-select[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff}.property-input[_ngcontent-%COMP%]:focus, .property-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.flow-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;max-width:80%;max-height:80%;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 20px 40px #0000004d}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid #e2e8f0}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;color:#6b7280;cursor:pointer}.modal-body[_ngcontent-%COMP%]{flex:1;padding:24px;overflow-y:auto}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;padding:20px 24px;border-top:1px solid #e2e8f0;justify-content:flex-end}@media (max-width: 1024px){.nodes-palette[_ngcontent-%COMP%]{width:250px}.properties-panel[_ngcontent-%COMP%]{width:280px}}"]})}}return a})();function Ve(a,m){if(a&1){let e=v();o(0,"div",18)(1,"button",19),f("click",function(){p(e);let t=d(2);return u(t.openFlowBuilder())}),c(2," \u{1F3A8} Abrir Constructor "),r()()}if(a&2){let e=d(2);l(),g("disabled",!e.isFlowBuilderEnabled)}}function Ne(a,m){if(a&1&&(o(0,"p",28),c(1),r()),a&2){let e=d().$implicit;l(),M(" ",e.description," ")}}function De(a,m){if(a&1){let e=v();o(0,"label",29)(1,"input",30),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.value,t)||(i.value=t),u(t)}),f("change",function(){p(e);let t=d().$implicit,i=d(2);return u(i.onSettingChange(t.key,t.value))}),r(),k(2,"span",31),r()}if(a&2){let e=d().$implicit;l(),y("ngModel",e.value)}}function Be(a,m){if(a&1&&(o(0,"option",34),c(1),r()),a&2){let e=m.$implicit;g("value",e.value),l(),M(" ",e.label," ")}}function Ie(a,m){if(a&1){let e=v();o(0,"select",32),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.value,t)||(i.value=t),u(t)}),f("change",function(){p(e);let t=d().$implicit,i=d(2);return u(i.onSettingChange(t.key,t.value))}),x(1,Be,2,2,"option",33),r()}if(a&2){let e=d().$implicit;y("ngModel",e.value),l(),g("ngForOf",e.options)}}function ze(a,m){if(a&1){let e=v();o(0,"input",35),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.value,t)||(i.value=t),u(t)}),f("blur",function(){p(e);let t=d().$implicit,i=d(2);return u(i.onSettingChange(t.key,t.value))}),r()}if(a&2){let e=d().$implicit;y("ngModel",e.value)}}function $e(a,m){if(a&1){let e=v();o(0,"input",36),w("ngModelChange",function(t){p(e);let i=d().$implicit;return b(i.value,t)||(i.value=t),u(t)}),f("blur",function(){p(e);let t=d().$implicit,i=d(2);return u(i.onSettingChange(t.key,t.value))}),r()}if(a&2){let e=d().$implicit;y("ngModel",e.value)}}function je(a,m){if(a&1&&(o(0,"div",20)(1,"div",21)(2,"label"),c(3),r(),x(4,Ne,2,1,"p",22),r(),o(5,"div",23),x(6,De,3,1,"label",24)(7,Ie,2,2,"select",25)(8,ze,1,1,"input",26)(9,$e,1,1,"input",27),r()()),a&2){let e=m.$implicit;l(3),h(e.label),l(),g("ngIf",e.description),l(2),g("ngIf",e.type==="toggle"),l(),g("ngIf",e.type==="select"),l(),g("ngIf",e.type==="input"),l(),g("ngIf",e.type==="number")}}function Ae(a,m){if(a&1&&(o(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13),c(4),r(),o(5,"div",14)(6,"h2"),c(7),r(),o(8,"p"),c(9),r()()(),x(10,Ve,3,1,"div",15),r(),o(11,"div",16),x(12,je,10,6,"div",17),r()()),a&2){let e=m.$implicit;l(4),h(e.icon),l(3),h(e.title),l(2),h(e.description),l(),g("ngIf",e.id==="flow-builder"),l(2),g("ngForOf",e.settings)}}function We(a,m){if(a&1){let e=v();o(0,"div",37),f("click",function(){p(e);let t=d();return u(t.closeFlowBuilderModal())}),o(1,"div",38),f("click",function(t){return p(e),u(t.stopPropagation())}),k(2,"app-flow-builder"),o(3,"button",39),f("click",function(){p(e);let t=d();return u(t.closeFlowBuilderModal())}),c(4,"\u2715"),r()()()}}var Ze=(()=>{class a{get isFlowBuilderEnabled(){return this.configSections.find(t=>t.id==="flow-builder")?.settings.find(t=>t.key==="enableFlowBuilder")?.value===!0}constructor(e){this.router=e,this.showFlowBuilderModal=!1,this.configSections=[{id:"general",title:"Configuraci\xF3n General",description:"Ajustes b\xE1sicos de la aplicaci\xF3n",icon:"\u{1F527}",settings:[{key:"theme",label:"Tema de la aplicaci\xF3n",type:"select",value:"light",options:[{value:"light",label:"Claro"},{value:"dark",label:"Oscuro"},{value:"auto",label:"Autom\xE1tico"}],description:"Selecciona el tema visual de la aplicaci\xF3n"},{key:"language",label:"Idioma",type:"select",value:"es",options:[{value:"es",label:"Espa\xF1ol"},{value:"en",label:"English"}]},{key:"autoSave",label:"Guardado autom\xE1tico",type:"toggle",value:!0,description:"Guarda autom\xE1ticamente los cambios sin confirmar"}]},{id:"notifications",title:"Notificaciones",description:"Controla qu\xE9 notificaciones recibir",icon:"\u{1F514}",settings:[{key:"emailNotifications",label:"Notificaciones por email",type:"toggle",value:!0,description:"Recibir notificaciones importantes por correo electr\xF3nico"},{key:"pushNotifications",label:"Notificaciones push",type:"toggle",value:!1,description:"Mostrar notificaciones en el navegador"},{key:"reminderFrequency",label:"Frecuencia de recordatorios",type:"select",value:"daily",options:[{value:"never",label:"Nunca"},{value:"daily",label:"Diario"},{value:"weekly",label:"Semanal"}]}]},{id:"data",title:"Gesti\xF3n de Datos",description:"Configuraci\xF3n de almacenamiento y sincronizaci\xF3n",icon:"\u{1F4BE}",settings:[{key:"dataRetention",label:"Retenci\xF3n de datos (d\xEDas)",type:"number",value:365,description:"N\xFAmero de d\xEDas para mantener los datos hist\xF3ricos"},{key:"syncFrequency",label:"Frecuencia de sincronizaci\xF3n",type:"select",value:"realtime",options:[{value:"realtime",label:"Tiempo real"},{value:"hourly",label:"Cada hora"},{value:"daily",label:"Diario"}]},{key:"offlineMode",label:"Modo sin conexi\xF3n",type:"toggle",value:!0,description:"Permitir uso de la aplicaci\xF3n sin conexi\xF3n a internet"}]},{id:"security",title:"Seguridad",description:"Configuraci\xF3n de seguridad y privacidad",icon:"\u{1F512}",settings:[{key:"sessionTimeout",label:"Tiempo de sesi\xF3n (minutos)",type:"number",value:30,description:"Tiempo antes de cerrar sesi\xF3n autom\xE1ticamente"},{key:"twoFactorAuth",label:"Autenticaci\xF3n de dos factores",type:"toggle",value:!1,description:"Activar verificaci\xF3n adicional al iniciar sesi\xF3n"},{key:"dataEncryption",label:"Cifrado de datos",type:"toggle",value:!0,description:"Cifrar datos sensibles almacenados localmente"}]},{id:"flow-builder",title:"Constructor de Flujos",description:"Herramientas visuales para crear nuevos flujos y ciudades",icon:"\u{1F3A8}",settings:[{key:"enableFlowBuilder",label:"Habilitar Constructor Visual",type:"toggle",value:!0,description:"Acceso al constructor visual de flujos estilo n8n/Zapier"}]}]}ngOnInit(){this.loadConfiguration()}openFlowBuilder(){this.isFlowBuilderEnabled&&(this.showFlowBuilderModal=!0)}closeFlowBuilderModal(){this.showFlowBuilderModal=!1}onSettingChange(e,n){console.log("Configuraci\xF3n cambiada:",e,n),this.saveToLocalStorage(e,n)}saveConfiguration(){let e={};this.configSections.forEach(n=>{n.settings.forEach(t=>{e[t.key]=t.value})}),localStorage.setItem("app-configuration",JSON.stringify(e)),console.log("Configuraci\xF3n guardada:",e)}resetToDefaults(){let e={theme:"light",language:"es",autoSave:!0,emailNotifications:!0,pushNotifications:!1,reminderFrequency:"daily",dataRetention:365,syncFrequency:"realtime",offlineMode:!0,sessionTimeout:30,twoFactorAuth:!1,dataEncryption:!0,enableFlowBuilder:!0};this.configSections.forEach(n=>{n.settings.forEach(t=>{e.hasOwnProperty(t.key)&&(t.value=e[t.key])})}),localStorage.removeItem("app-configuration"),console.log("Configuraci\xF3n restaurada a valores por defecto")}loadConfiguration(){let e=localStorage.getItem("app-configuration");if(e)try{let n=JSON.parse(e);this.configSections.forEach(t=>{t.settings.forEach(i=>{n.hasOwnProperty(i.key)&&(i.value=n[i.key])})})}catch(n){console.error("Error loading configuration:",n)}}saveToLocalStorage(e,n){let t=localStorage.getItem("app-configuration"),i={};if(t)try{i=JSON.parse(t)}catch(s){console.error("Error parsing saved configuration:",s)}i[e]=n,localStorage.setItem("app-configuration",JSON.stringify(i))}static{this.\u0275fac=function(n){return new(n||a)(H(ee))}}static{this.\u0275cmp=T({type:a,selectors:[["app-configuracion"]],standalone:!0,features:[E],decls:15,vars:2,consts:[[1,"configuracion-container"],[1,"page-header"],[1,"page-description"],[1,"page-main"],[1,"config-sections"],["class","config-section",4,"ngFor","ngForOf"],[1,"actions-section"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click"],["class","flow-builder-modal",3,"click",4,"ngIf"],[1,"config-section"],[1,"section-header"],[1,"section-info"],[1,"section-icon"],[1,"section-details"],["class","section-actions",4,"ngIf"],[1,"section-content"],["class","setting-item",4,"ngFor","ngForOf"],[1,"section-actions"],[1,"flow-builder-btn",3,"click","disabled"],[1,"setting-item"],[1,"setting-label"],["class","setting-description",4,"ngIf"],[1,"setting-control"],["class","toggle-switch",4,"ngIf"],["class","setting-select",3,"ngModel","ngModelChange","change",4,"ngIf"],["type","text","class","setting-input",3,"ngModel","ngModelChange","blur",4,"ngIf"],["type","number","class","setting-input",3,"ngModel","ngModelChange","blur",4,"ngIf"],[1,"setting-description"],[1,"toggle-switch"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"toggle-slider"],[1,"setting-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","text",1,"setting-input",3,"ngModelChange","blur","ngModel"],["type","number",1,"setting-input",3,"ngModelChange","blur","ngModel"],[1,"flow-builder-modal",3,"click"],[1,"modal-content-wrapper",3,"click"],[1,"modal-close-btn",3,"click"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"header",1)(2,"h1"),c(3,"\u2699\uFE0F Configuraci\xF3n"),r(),o(4,"p",2),c(5,"Personaliza tu experiencia en la aplicaci\xF3n"),r()(),o(6,"main",3)(7,"div",4),x(8,Ae,13,5,"div",5),r(),o(9,"div",6)(10,"button",7),f("click",function(){return t.resetToDefaults()}),c(11," \u{1F504} Restaurar Valores por Defecto "),r(),o(12,"button",8),f("click",function(){return t.saveConfiguration()}),c(13," \u{1F4BE} Guardar Configuraci\xF3n "),r()()(),x(14,We,5,0,"div",9),r()),n&2&&(l(8),g("ngForOf",t.configSections),l(6),g("ngIf",t.showFlowBuilderModal))},dependencies:[D,V,N,G,A,W,I,te,B,j,z,$,ne],styles:['.configuracion-container[_ngcontent-%COMP%]{padding:24px;max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px;padding-bottom:24px;border-bottom:2px solid #e2e8f0}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;color:#2d3748;font-size:2rem;font-weight:700}.page-description[_ngcontent-%COMP%]{margin:0;color:#718096;font-size:1.1rem}.config-sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;margin-bottom:32px}.config-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden}.section-header[_ngcontent-%COMP%]{padding:20px;background:#f7fafc;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.section-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.section-icon[_ngcontent-%COMP%]{font-size:2rem;width:48px;height:48px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:8px;border:1px solid #e2e8f0}.section-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 4px;color:#2d3748;font-size:1.3rem;font-weight:600}.section-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#718096;font-size:.9rem}.section-content[_ngcontent-%COMP%]{padding:0}.setting-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #f1f5f9}.setting-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.setting-label[_ngcontent-%COMP%]{flex:1}.setting-label[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#2d3748;margin-bottom:4px}.setting-description[_ngcontent-%COMP%]{margin:0;font-size:.8rem;color:#718096;line-height:1.4}.setting-control[_ngcontent-%COMP%]{flex-shrink:0;margin-left:20px}.toggle-switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:50px;height:26px}.toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.toggle-slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:#cbd5e0;transition:.4s;border-radius:26px}.toggle-slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input[_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]{background-color:#4299e1}input[_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]:before{transform:translate(24px)}.setting-select[_ngcontent-%COMP%], .setting-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:#fff;font-size:.9rem;min-width:150px}.setting-select[_ngcontent-%COMP%]:focus, .setting-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4299e1;box-shadow:0 0 0 3px #4299e11a}.actions-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;padding:24px 0;border-top:1px solid #e2e8f0}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;font-size:.9rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4299e1,#3182ce);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3182ce,#2c5282);transform:translateY(-1px)}.btn-secondary[_ngcontent-%COMP%]{background:#f7fafc;color:#4a5568;border:1px solid #e2e8f0}.btn-secondary[_ngcontent-%COMP%]:hover{background:#edf2f7}.flow-builder-btn[_ngcontent-%COMP%]{padding:8px 16px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;border:none;border-radius:6px;font-weight:500;cursor:pointer;transition:all .2s;font-size:.9rem}.flow-builder-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#7c3aed,#6d28d9);transform:translateY(-1px);box-shadow:0 4px 12px #8b5cf64d}.flow-builder-btn[_ngcontent-%COMP%]:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}.flow-builder-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content-wrapper[_ngcontent-%COMP%]{position:relative;width:95%;height:95%;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 25px 50px #00000040}.modal-close-btn[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;width:32px;height:32px;background:#ffffffe6;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:#374151;z-index:10;transition:all .2s}.modal-close-btn[_ngcontent-%COMP%]:hover{background:#fff;transform:scale(1.1)}@media (max-width: 768px){.configuracion-container[_ngcontent-%COMP%]{padding:16px}.setting-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.setting-control[_ngcontent-%COMP%]{margin-left:0;align-self:flex-end}.actions-section[_ngcontent-%COMP%]{flex-direction:column}}']})}}return a})();export{Ze as ConfiguracionComponent};
