import{a as h}from"./chunk-ULB2DFX5.js";import{a as c}from"./chunk-QCEAPM7G.js";import{G as p,V as y,_ as g,j as P,n as d}from"./chunk-5IDTUAMZ.js";var M=(()=>{class s{constructor(e){this.financialCalc=e}getProductPackage(e){let n={"aguascalientes-plazo":{name:"Paquete Venta a Plazo - Aguascalientes",rate:.255,terms:[12,24],minDownPaymentPercentage:.6,components:[{id:"vagoneta_19p",name:"Vagoneta H6C (19 Pasajeros)",price:799e3,isOptional:!1},{id:"gnv",name:"Conversi\xF3n GNV",price:54e3,isOptional:!1}]},"aguascalientes-directa":{name:"Paquete Compra de Contado - Aguascalientes",rate:0,terms:[],minDownPaymentPercentage:.5,components:[{id:"vagoneta_19p",name:"Vagoneta H6C (19 Pasajeros)",price:799e3,isOptional:!1},{id:"gnv",name:"Conversi\xF3n GNV",price:54e3,isOptional:!0}]},"edomex-plazo":{name:"Paquete Venta a Plazo (Individual) - EdoMex",rate:.299,terms:[48,60],minDownPaymentPercentage:.2,maxDownPaymentPercentage:.25,components:[{id:"vagoneta_ventanas",name:"Vagoneta H6C (Ventanas)",price:749e3,isOptional:!1},{id:"gnv",name:"Conversi\xF3n GNV",price:54e3,isOptional:!1},{id:"tec",name:"Paquete Tec (GPS, C\xE1maras)",price:12e3,isOptional:!1},{id:"bancas",name:"Bancas",price:22e3,isOptional:!1},{id:"seguro",name:"Seguro Anual",price:36700,isOptional:!1,isMultipliedByTerm:!0}]},"edomex-directa":{name:"Paquete Compra de Contado - EdoMex",rate:0,terms:[],minDownPaymentPercentage:.5,components:[{id:"vagoneta_ventanas",name:"Vagoneta H6C (Ventanas)",price:749e3,isOptional:!1},{id:"gnv",name:"Conversi\xF3n GNV",price:54e3,isOptional:!1},{id:"bancas",name:"Bancas",price:22e3,isOptional:!1}]},"edomex-colectivo":{name:"Paquete Cr\xE9dito Colectivo - EdoMex",rate:.299,terms:[60],minDownPaymentPercentage:.15,maxDownPaymentPercentage:.2,defaultMembers:5,maxMembers:20,components:[{id:"vagoneta_ventanas",name:"Vagoneta H6C (Ventanas)",price:749e3,isOptional:!1},{id:"gnv",name:"Conversi\xF3n GNV",price:54e3,isOptional:!1},{id:"tec",name:"Paquete Tec (GPS, C\xE1maras)",price:12e3,isOptional:!1},{id:"bancas",name:"Bancas",price:22e3,isOptional:!1},{id:"seguro",name:"Seguro Anual",price:36700,isOptional:!1,isMultipliedByTerm:!0}]}}[e];if(!n)throw new Error(`Paquete no encontrado para mercado: ${e}`);return P(n).pipe(p(600))}calculatePackagePrice(e,t=1,n=[]){return e.components.reduce((i,a)=>{if(a.isOptional&&!n.includes(a.id))return i;let o=a.price;if(a.isMultipliedByTerm){let r=Math.ceil(t/12);o=o*r}return i+o},0)}getBalance(e,t,n,i){if(t===0)return e-e/n*i;let a=t/12,o=this.financialCalc.annuity(e,a,n),r=e;for(let l=0;l<i;l++){let m=r*a,u=o-m;r=Math.max(0,r-u)}return r}generateQuoteWithPackage(e,t=[],n=0,i=12){return this.getProductPackage(e).pipe(p(100),d(a=>{let o=this.calculatePackagePrice(a,i,t),r=n||o*a.minDownPaymentPercentage,l=o-r,m=a.rate/12,u=m>0?this.financialCalc.annuity(l,m,i):0;return{totalPrice:o,downPayment:r,amountToFinance:l,term:i,monthlyPayment:u,market:e,clientType:a.defaultMembers?"Colectivo":"Individual",flow:this.getBusinessFlowFromMarket(e),packageData:a}}))}generateQuote(e){let t=e.totalPrice-e.downPayment,n=this.getMonthlyRate(e.market),i=this.financialCalc.annuity(t,n,e.term);return{totalPrice:e.totalPrice,downPayment:e.downPayment,amountToFinance:t,term:e.term,monthlyPayment:i,market:e.market,clientType:e.clientType,flow:e.businessFlow}}getBusinessFlowFromMarket(e){return e.includes("directa")?c.VentaDirecta:e.includes("colectivo")?c.CreditoColectivo:e.includes("plazo")?c.VentaPlazo:c.AhorroProgramado}generateAmortizationTable(e){let t=this.getMonthlyRate(e.market),n=[],i=e.amountToFinance;for(let a=1;a<=e.term;a++){let o=i*t,r=e.monthlyPayment-o;i=Math.max(0,i-r),n.push({payment:a,principalPayment:r,interestPayment:o,balance:i})}return n}getMonthlyRate(e){return this.financialCalc.getTIRMin(e)/12}validateConfiguration(e){let t=[],n=this.getMinimumDownPayment(e.market,e.clientType);e.downPayment/e.totalPrice<n&&t.push(`El enganche m\xEDnimo para ${e.clientType} en ${e.market} es ${(n*100).toFixed(0)}%`);let a=this.getAllowedTerms(e.market);return a.includes(e.term)||t.push(`Los plazos permitidos para ${e.market} son: ${a.join(", ")} meses`),e.totalPrice<=0&&t.push("El precio total debe ser mayor a cero"),e.downPayment>=e.totalPrice&&t.push("El enganche no puede ser igual o mayor al precio total"),{valid:t.length===0,errors:t}}getMinimumDownPayment(e,t){return e==="aguascalientes"?.6:e==="edomex"?t==="Colectivo"?.15:.25:.2}getAllowedTerms(e){return e==="aguascalientes"?[12,24]:e==="edomex"?[48,60]:[12,24]}getTotalInterest(e){return e.monthlyPayment*e.term-e.amountToFinance}getFinancialSummary(e){let t=this.getTotalInterest(e),n=e.totalPrice+t,i=this.financialCalc.getTIRMin(e.market);return{totalCost:n,totalInterest:t,effectiveRate:i*100}}static{this.\u0275fac=function(t){return new(t||s)(g(h))}}static{this.\u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{M as a};
