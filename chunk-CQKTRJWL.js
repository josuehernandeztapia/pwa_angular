import{a as H}from"./chunk-AIYREKCX.js";import"./chunk-FK6H3RFT.js";import{m as E}from"./chunk-SCHFUJ5K.js";import{a as W}from"./chunk-YNTR5Z62.js";import"./chunk-ULB2DFX5.js";import{a as R}from"./chunk-YYSQDTD3.js";import"./chunk-QCEAPM7G.js";import{b as I,c as b,d as z,e as T,h as A,i as F,j as V,l as Q,m as N,n as q,o as B,p as G,r as j,t as L,u as X,v as $}from"./chunk-S2UEMBMO.js";import{Ea as a,Fa as h,Sa as g,Ua as s,Xb as S,Ya as n,Yb as D,Za as t,_a as O,ac as w,bb as C,bc as k,cb as p,db as l,ea as y,ib as o,jb as _,kb as v,ma as m,na as u,sb as M,vb as f,yb as x}from"./chunk-5IDTUAMZ.js";import"./chunk-DM275RSA.js";function U(i,d){if(i&1){let e=C();n(0,"label",25)(1,"input",26),p("change",function(){m(e);let c=l().$implicit,P=l(3);return u(P.onOptionalToggle(c.id))}),t(),n(2,"span"),o(3),t(),n(4,"strong"),o(5),f(6,"currency"),t()()}if(i&2){let e=l().$implicit,r=l(3);a(),s("checked",r.selectedOptionals.includes(e.id)),a(2),_(e.name),a(2),_(x(6,3,e.price,"MXN","symbol","1.0-0"))}}function Y(i,d){if(i&1&&(n(0,"div",27)(1,"span"),o(2),t(),n(3,"strong"),o(4),f(5,"currency"),t()()),i&2){let e=l().$implicit;a(2),v("\u2705 ",e.name,""),a(2),_(x(5,2,e.price,"MXN","symbol","1.0-0"))}}function K(i,d){if(i&1&&(n(0,"div",22),g(1,U,7,8,"label",23)(2,Y,6,7,"div",24),t()),i&2){let e=d.$implicit;a(),s("ngIf",e.isOptional),a(),s("ngIf",!e.isOptional)}}function Z(i,d){if(i&1&&(n(0,"div",8)(1,"h3"),o(2,"\u{1F4E6} Paquete Aguascalientes"),t(),n(3,"div",16)(4,"div",17)(5,"h4"),o(6,"\u{1F690} Vagoneta H6C (19 Pasajeros)"),t(),n(7,"div",18),o(8,"$799,000 MXN"),t()(),n(9,"div",19),g(10,K,3,2,"div",20),t(),n(11,"div",21)(12,"span"),o(13,"Total del Paquete:"),t(),n(14,"strong"),o(15),f(16,"currency"),t()()()()),i&2){let e=l(2);a(10),s("ngForOf",e.packageData.components),a(5),_(x(16,2,e.totalPrice,"MXN","symbol","1.0-0"))}}function ee(i,d){if(i&1&&(n(0,"option",36),o(1),t()),i&2){let e=d.$implicit;s("value",e),a(),v("",e," meses")}}function te(i,d){if(i&1){let e=C();n(0,"div",29)(1,"label"),o(2,"Plazo"),t(),n(3,"select",33),p("change",function(){m(e);let c=l(3);return u(c.onConfigChange())}),n(4,"option",34),o(5,"Seleccionar"),t(),g(6,ee,2,2,"option",35),t()()}if(i&2){let e=l(3);a(6),s("ngForOf",e.availableTerms)}}function ne(i,d){if(i&1){let e=C();n(0,"div",8)(1,"h3"),o(2,"\u{1F4B3} Configuraci\xF3n"),t(),g(3,te,7,1,"div",28),n(4,"div",29)(5,"label"),o(6),t(),n(7,"div",30)(8,"span"),o(9,"$"),t(),n(10,"input",31),p("input",function(){m(e);let c=l(2);return u(c.onConfigChange())}),t()(),n(11,"small"),o(12),f(13,"currency"),t()(),n(14,"button",32),p("click",function(){m(e);let c=l(2);return u(c.calculateQuote())}),o(15),t()()}if(i&2){let e=l(2);a(3),s("ngIf",e.isPlazoSale()),a(3),v("Enganche (M\xEDnimo ",e.minDownPaymentPct,"%)"),a(4),s("min",e.minDownPayment),a(2),v("M\xEDnimo: ",x(13,6,e.minDownPayment,"MXN","symbol","1.0-0"),""),a(2),s("disabled",!e.canCalculate()),a(),v(" ",e.isCalculating?"Calculando...":"\u{1F9EE} Calcular"," ")}}function ie(i,d){if(i&1&&(n(0,"div",40)(1,"span"),o(2,"A Financiar"),t(),n(3,"span"),o(4),f(5,"currency"),t()()),i&2){let e=l(3);a(4),_(x(5,1,e.currentQuote.amountToFinance,"MXN","symbol","1.0-0"))}}function oe(i,d){if(i&1&&(n(0,"div",47)(1,"span"),o(2,"Pago Mensual"),t(),n(3,"strong",48),o(4),f(5,"currency"),t()()),i&2){let e=l(3);a(4),_(x(5,1,e.currentQuote.monthlyPayment,"MXN","symbol","1.0-0"))}}function ae(i,d){if(i&1&&(n(0,"div",40)(1,"span"),o(2,"Plazo"),t(),n(3,"span"),o(4),t()()),i&2){let e=l(3);a(4),v("",e.currentQuote.term," meses")}}function re(i,d){i&1&&(n(0,"div",40)(1,"span"),o(2,"Tasa Anual"),t(),n(3,"span"),o(4,"25.5%"),t()())}function ce(i,d){if(i&1){let e=C();n(0,"div",37)(1,"h3"),o(2,"\u{1F4CB} Cotizaci\xF3n AGS"),t(),n(3,"div",38)(4,"div",39)(5,"span"),o(6,"Precio Total"),t(),n(7,"strong"),o(8),f(9,"currency"),t()(),n(10,"div",40)(11,"span"),o(12,"Enganche"),t(),n(13,"span"),o(14),f(15,"currency"),t()(),g(16,ie,6,6,"div",41)(17,oe,6,6,"div",42)(18,ae,5,1,"div",41)(19,re,5,0,"div",41),t(),n(20,"div",43)(21,"button",44),p("click",function(){m(e);let c=l(2);return u(c.generatePDF())}),o(22,"\u{1F4C4} Descargar PDF"),t(),n(23,"button",45),p("click",function(){m(e);let c=l(2);return u(c.proceedWithQuote())}),o(24,"\u2705 Continuar"),t(),n(25,"button",46),p("click",function(){m(e);let c=l(2);return u(c.resetQuote())}),o(26,"\u{1F504} Nueva Cotizaci\xF3n"),t()()()}if(i&2){let e=l(2);a(8),_(x(9,6,e.currentQuote.totalPrice,"MXN","symbol","1.0-0")),a(6),_(x(15,11,e.currentQuote.downPayment,"MXN","symbol","1.0-0")),a(2),s("ngIf",e.isPlazoSale()),a(),s("ngIf",e.isPlazoSale()),a(),s("ngIf",e.isPlazoSale()),a(),s("ngIf",e.isPlazoSale())}}function le(i,d){if(i&1){let e=C();n(0,"div",5)(1,"div",6)(2,"form",7)(3,"div",8)(4,"h3"),o(5,"\u{1F4B0} Tipo de Venta"),t(),n(6,"div",9)(7,"label",10)(8,"input",11),p("change",function(){m(e);let c=l();return u(c.onSaleTypeChange())}),t(),n(9,"div",12)(10,"strong"),o(11,"Venta a Plazo"),t(),n(12,"small"),o(13,"12-24 meses \u2022 Enganche 60% \u2022 Tasa 25.5%"),t()()(),n(14,"label",10)(15,"input",13),p("change",function(){m(e);let c=l();return u(c.onSaleTypeChange())}),t(),n(16,"div",12)(17,"strong"),o(18,"Compra de Contado"),t(),n(19,"small"),o(20,"Sin financiamiento \u2022 Enganche 50%"),t()()()()(),g(21,Z,17,7,"div",14)(22,ne,16,11,"div",14),t()(),g(23,ce,27,16,"div",15),t()}if(i&2){let e=l();a(2),s("formGroup",e.cotizadorForm),a(19),s("ngIf",e.packageData),a(),s("ngIf",e.packageData),a(),s("ngIf",e.currentQuote)}}function se(i,d){i&1&&(n(0,"div",49),O(1,"div",50),n(2,"p"),o(3,"Cargando paquete AGS..."),t()())}var he=(()=>{class i{constructor(e,r,c,P,J){this.fb=e,this.router=r,this.cotizadorEngine=c,this.toast=P,this.pdfExportService=J,this.selectedOptionals=[],this.isLoading=!0,this.isCalculating=!1,this.createForm()}ngOnInit(){this.loadDefaultPackage()}createForm(){this.cotizadorForm=this.fb.group({saleType:["aguascalientes-plazo",b.required],term:[12,b.required],downPayment:[0,[b.required,b.min(1)]]})}loadDefaultPackage(){this.isLoading=!0,this.cotizadorEngine.getProductPackage("aguascalientes-plazo").subscribe({next:e=>{this.packageData=e,this.updateFormDefaults(),this.isLoading=!1},error:e=>{this.toast.error("Error al cargar el paquete AGS"),this.isLoading=!1}})}onSaleTypeChange(){let e=this.cotizadorForm.get("saleType")?.value;e&&(this.isLoading=!0,this.currentQuote=void 0,this.cotizadorEngine.getProductPackage(e).subscribe({next:r=>{this.packageData=r,this.selectedOptionals=[],this.updateFormDefaults(),this.isLoading=!1},error:()=>{this.toast.error("Error al cambiar tipo de venta"),this.isLoading=!1}}))}updateFormDefaults(){if(!this.packageData)return;this.packageData.terms.length>0&&this.cotizadorForm.patchValue({term:this.packageData.terms[0]});let e=this.totalPrice*this.packageData.minDownPaymentPercentage;this.cotizadorForm.patchValue({downPayment:e})}onOptionalToggle(e){let r=this.selectedOptionals.indexOf(e);r>-1?this.selectedOptionals.splice(r,1):this.selectedOptionals.push(e),this.updateDownPayment(),this.currentQuote=void 0}onConfigChange(){this.currentQuote=void 0}updateDownPayment(){if(!this.packageData)return;let e=this.totalPrice*this.packageData.minDownPaymentPercentage;(this.cotizadorForm.get("downPayment")?.value||0)<e&&this.cotizadorForm.patchValue({downPayment:e})}calculateQuote(){if(!this.canCalculate())return;let e=this.cotizadorForm.value;this.isCalculating=!0,this.cotizadorEngine.generateQuoteWithPackage(e.saleType,this.selectedOptionals,e.downPayment,this.isPlazoSale()?e.term:0).subscribe({next:r=>{this.currentQuote=r,this.isCalculating=!1,this.toast.success("Cotizaci\xF3n AGS calculada")},error:()=>{this.toast.error("Error al calcular cotizaci\xF3n"),this.isCalculating=!1}})}proceedWithQuote(){this.currentQuote&&(sessionStorage.setItem("pendingQuote",JSON.stringify(this.currentQuote)),this.toast.success("Cotizaci\xF3n guardada, creando cliente..."),this.router.navigate(["/clientes/nuevo"],{queryParams:{fromQuote:"true",market:"aguascalientes",flow:this.currentQuote.flow}}))}resetQuote(){this.currentQuote=void 0,this.toast.info("Cotizaci\xF3n limpiada")}goBack(){this.router.navigate(["/"])}get totalPrice(){return this.packageData?this.cotizadorEngine.calculatePackagePrice(this.packageData,this.isPlazoSale()&&this.cotizadorForm.get("term")?.value||1,this.selectedOptionals):0}get availableTerms(){return this.packageData?.terms||[]}get minDownPayment(){return this.packageData?this.totalPrice*this.packageData.minDownPaymentPercentage:0}get minDownPaymentPct(){return this.packageData?Math.round(this.packageData.minDownPaymentPercentage*100):0}isPlazoSale(){return this.cotizadorForm.get("saleType")?.value?.includes("plazo")||!1}canCalculate(){let e=this.cotizadorForm;return e.valid&&e.get("downPayment")?.value>=this.minDownPayment&&(!this.isPlazoSale()||e.get("term")?.value)&&!this.isCalculating}generatePDF(){if(!this.currentQuote||!this.packageData){this.toast.error("No hay cotizaci\xF3n disponible para generar PDF");return}let e={clientInfo:{name:"Cliente AGS",contact:"N/A"},ecosystemInfo:{name:"Aguascalientes",route:"AGS-Ruta",market:"AGS"},quoteDetails:{vehicleValue:this.currentQuote.totalPrice,downPaymentOptions:[this.currentQuote.downPayment],monthlyPaymentOptions:[this.currentQuote.monthlyPayment||0],termOptions:[this.currentQuote.term||0],interestRate:25.5},validUntil:new Date(Date.now()+7*24*60*60*1e3),quoteNumber:`AGS-${Date.now()}`};this.pdfExportService.generateQuotePDF(e).then(()=>{this.toast.success("PDF generado exitosamente")}).catch(()=>{this.toast.error("Error al generar PDF")})}static{this.\u0275fac=function(r){return new(r||i)(h(L),h(E),h(W),h(R),h(H))}}static{this.\u0275cmp=y({type:i,selectors:[["app-ags-individual"]],standalone:!0,features:[M],decls:10,vars:2,consts:[[1,"ags-cotizador"],[1,"header"],[1,"back-btn",3,"click"],["class","content",4,"ngIf"],["class","loading",4,"ngIf"],[1,"content"],[1,"config-panel"],[3,"formGroup"],[1,"section"],[1,"radio-group"],[1,"radio-option"],["type","radio","formControlName","saleType","value","aguascalientes-plazo",3,"change"],[1,"option-info"],["type","radio","formControlName","saleType","value","aguascalientes-directa",3,"change"],["class","section",4,"ngIf"],["class","quote-panel",4,"ngIf"],[1,"package-info"],[1,"vehicle-card"],[1,"price"],[1,"components"],["class","component",4,"ngFor","ngForOf"],[1,"total-price"],[1,"component"],["class","checkbox-label",4,"ngIf"],["class","required-component",4,"ngIf"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"required-component"],["class","form-group",4,"ngIf"],[1,"form-group"],[1,"currency-input"],["type","number","formControlName","downPayment","placeholder","Monto",3,"input","min"],["type","button",1,"calc-btn",3,"click","disabled"],["formControlName","term",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"quote-panel"],[1,"quote-summary"],[1,"summary-item","total"],[1,"summary-item"],["class","summary-item",4,"ngIf"],["class","summary-item highlight",4,"ngIf"],[1,"quote-actions"],[1,"pdf-btn",3,"click"],[1,"proceed-btn",3,"click"],[1,"reset-btn",3,"click"],[1,"summary-item","highlight"],[1,"monthly"],[1,"loading"],[1,"spinner"]],template:function(r,c){r&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return c.goBack()}),o(3,"\u2190 Volver"),t(),n(4,"h1"),o(5,"\u{1F335} Cotizador AGS Individual"),t(),n(6,"p"),o(7,"Aguascalientes \u2022 Venta a Plazo & Compra de Contado"),t()(),g(8,le,24,4,"div",3)(9,se,4,0,"div",4),t()),r&2&&(a(8),s("ngIf",!c.isLoading),a(),s("ngIf",c.isLoading))},dependencies:[k,S,D,w,X,A,B,G,I,F,q,V,z,T,j,$,Q,N],styles:[".ags-cotizador[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:24px;background:#f8fafc;min-height:100vh}.header[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px}.back-btn[_ngcontent-%COMP%]{display:inline-block;margin-bottom:16px;padding:8px 16px;background:#e2e8f0;border:none;border-radius:6px;cursor:pointer;transition:background .2s}.back-btn[_ngcontent-%COMP%]:hover{background:#cbd5e1}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#1e293b;margin:0 0 8px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#64748b;margin:0}.content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start}@media (max-width: 1024px){.content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.config-panel[_ngcontent-%COMP%], .quote-panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px -1px #0000001a;padding:24px}.section[_ngcontent-%COMP%]{margin-bottom:24px}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#374151;margin-bottom:16px}.radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.radio-option[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;padding:16px;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;transition:all .2s}.radio-option[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background:#f8fafc}.radio-option[_ngcontent-%COMP%]:has(input:checked){border-color:#3b82f6;background:#eff6ff}.option-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#374151;margin-bottom:4px}.option-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6b7280;font-size:13px}.package-info[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:16px}.vehicle-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#f8fafc;border-radius:8px;margin-bottom:16px}.vehicle-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#374151}.vehicle-card[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#059669}.components[_ngcontent-%COMP%]{margin-bottom:16px}.component[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid #f3f4f6}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;cursor:pointer}.required-component[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.total-price[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:18px;font-weight:600;padding-top:16px;border-top:2px solid #e5e7eb;color:#374151}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:6px;color:#374151}.form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:16px}.currency-input[_ngcontent-%COMP%]{position:relative}.currency-input[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#6b7280;font-weight:500}.currency-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:32px}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:12px;color:#6b7280}.calc-btn[_ngcontent-%COMP%]{width:100%;padding:12px;background:#3b82f6;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:background .2s}.calc-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.calc-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.quote-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#374151;margin-bottom:20px}.quote-summary[_ngcontent-%COMP%]{margin-bottom:24px}.summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f3f4f6}.summary-item.total[_ngcontent-%COMP%]{font-size:18px;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:16px;margin-bottom:8px}.summary-item.highlight[_ngcontent-%COMP%]{background:#f0f9ff;margin:0 -16px;padding:16px;border-radius:6px;border:none;font-weight:600}.summary-item[_ngcontent-%COMP%]   .monthly[_ngcontent-%COMP%]{color:#059669;font-size:20px}.quote-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.proceed-btn[_ngcontent-%COMP%], .reset-btn[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all .2s}.proceed-btn[_ngcontent-%COMP%]{background:#059669;color:#fff}.proceed-btn[_ngcontent-%COMP%]:hover{background:#047857}.reset-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.reset-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}.pdf-btn[_ngcontent-%COMP%]{width:100%;padding:12px;background:#dc2626;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all .2s}.pdf-btn[_ngcontent-%COMP%]:hover{background:#b91c1c}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:64px;color:#6b7280}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid #f3f4f6;border-top:3px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})}}return i})();export{he as AgsIndividualComponent};
