import{a as te,c as ie}from"./chunk-4M7CYCOE.js";import{e as B,n as G,p as H}from"./chunk-SCHFUJ5K.js";import{a as ee}from"./chunk-YYSQDTD3.js";import{b as Y,d as X,g as q,n as J,o as K,p as Q,u as Z}from"./chunk-S2UEMBMO.js";import{$ as E,A as C,Ea as a,I as T,Kb as b,Lb as $,Ma as _,Sa as u,Ua as l,V as R,Va as k,Wa as P,Xa as z,Xb as U,Ya as n,Yb as W,Za as i,_a as w,bb as S,bc as j,cb as g,db as d,ea as V,ib as o,jb as m,k as F,kb as v,lb as O,ma as f,mb as L,na as x,ob as y,pb as D,qb as M,sb as N,ub as I}from"./chunk-5IDTUAMZ.js";import"./chunk-DM275RSA.js";var ne=(()=>{class s{constructor(){this.http=E(B),this.baseUrl=window.__BFF_BASE__??"/api"}getPosition(e,t){let r={market:e,sku:t};return this.http.get(`${this.baseUrl}/v1/stock/position`,{params:r}).pipe(C(this.handleError("get stock position")))}getAllPositions(e){let t={market:e};return this.http.get(`${this.baseUrl}/v1/stock/positions`,{params:t}).pipe(C(this.handleError("get all stock positions")))}getAlerts(e){let t={};return e&&(t.market=e),this.http.get(`${this.baseUrl}/v1/stock/alerts`,{params:t}).pipe(C(this.handleError("get stock alerts")))}recomputeForecast(){return this.http.post(`${this.baseUrl}/v1/stock/forecast/recompute`,{}).pipe(C(this.handleError("recompute forecast")))}updatePosition(e,t,r){return this.http.patch(`${this.baseUrl}/v1/stock/position/${e}/${t}`,r).pipe(C(this.handleError("update stock position")))}resolveAlert(e,t){return this.http.patch(`${this.baseUrl}/v1/stock/alerts/${e}/resolve`,{resolution:t}).pipe(C(this.handleError("resolve stock alert")))}getSummary(e){let t={};return e&&(t.market=e),this.http.get(`${this.baseUrl}/v1/stock/summary`,{params:t}).pipe(C(this.handleError("get stock summary")))}handleError(e){return t=>{console.error(`StockService.${e} failed:`,t);let r="Error en el servicio de inventario";return t.status===404?r="Informaci\xF3n de stock no encontrada":t.status===403?r="No tienes permisos para gestionar inventario":t.status===400?r=t.error?.message||"Solicitud inv\xE1lida":t.status>=500&&(r="Error del servidor. Intenta m\xE1s tarde"),F(()=>({operation:e,originalError:t,userMessage:r,timestamp:new Date().toISOString()}))}}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=R({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var A=s=>["/ops/deliveries",s];function ae(s,c){if(s&1&&(n(0,"option",27),o(1),i()),s&2){let e=c.$implicit;l("value",e.id),a(),v(" ",e.name," ")}}function oe(s,c){if(s&1){let e=S();n(0,"div",9)(1,"label",10),o(2,"\u{1F6E3}\uFE0F Ruta"),i(),n(3,"select",11),M("ngModelChange",function(r){f(e);let p=d();return D(p.selectedRoute,r)||(p.selectedRoute=r),x(r)}),g("change",function(){f(e);let r=d();return x(r.onRouteChange())}),n(4,"option",12),o(5,"Todas las rutas"),i(),u(6,ae,2,2,"option",17),i()()}if(s&2){let e=d();a(3),y("ngModel",e.selectedRoute),a(3),l("ngForOf",e.availableRoutes())}}function se(s,c){if(s&1&&(n(0,"option",27),o(1),i()),s&2){let e=c.$implicit,t=d();l("value",e),a(),v(" ",t.getStatusTitle(e)," ")}}function le(s,c){if(s&1){let e=S();n(0,"button",28),g("click",function(){f(e);let r=d();return x(r.clearFilters())}),o(1," \u{1F5D1}\uFE0F Limpiar filtros "),i()}}function ce(s,c){if(s&1&&(n(0,"div",45),o(1),i()),s&2){let e=c.$implicit;z("alert-"+e.severity),a(),v(" ",e.message," ")}}function de(s,c){if(s&1&&(n(0,"div",43),u(1,ce,2,3,"div",44),i()),s&2){let e=d().$implicit,t=d(2);a(),l("ngForOf",t.getMarketAlerts(e.market))}}function pe(s,c){if(s&1&&(n(0,"div",35)(1,"div",36)(2,"h3"),o(3),i(),n(4,"span",37),o(5),i()(),n(6,"div",38)(7,"div",39)(8,"span",40),o(9,"En stock"),i(),n(10,"span",41),o(11),i()(),n(12,"div",39)(13,"span",40),o(14,"En tr\xE1nsito"),i(),n(15,"span",41),o(16),i()(),n(17,"div",39)(18,"span",40),o(19,"Proyecci\xF3n"),i(),n(20,"span",41),o(21),i()()(),u(22,de,2,1,"div",42),i()),s&2){let e=c.$implicit,t=d(2);a(3),m(t.getMarketName(e.market)),a(2),m(e.sku),a(5),P("low-stock",e.onHand<e.reorderPoint),a(),v(" ",e.onHand," "),a(5),m(e.onOrder),a(5),m(e.forecast),a(),l("ngIf",t.getMarketAlerts(e.market).length>0)}}function me(s,c){if(s&1&&(n(0,"div",46)(1,"h4"),o(2),i(),n(3,"div",47)(4,"div",48)(5,"span",49),o(6),i(),n(7,"span",50),o(8,"Total pedidos"),i()(),n(9,"div",48)(10,"span",49),o(11),i(),n(12,"span",50),o(13,"En tr\xE1nsito"),i()(),n(14,"div",48)(15,"span",49),o(16),i(),n(17,"span",50),o(18,"Listas para entrega"),i()(),n(19,"div",48)(20,"span",49),o(21),i(),n(22,"span",50),o(23,"Entregadas"),i()()()()),s&2){let e=c.$implicit,t=d(2);a(2),m(t.getMarketName(e.market)),a(4),m(e.total),a(5),m(e.inTransit),a(5),m(e.readyForDelivery),a(5),m(e.delivered)}}function ue(s,c){if(s&1&&(n(0,"div",29)(1,"div",30),u(2,pe,23,8,"div",31),i(),n(3,"div",32)(4,"h3"),o(5,"\u{1F4CA} Resumen de Entregas por Mercado"),i(),n(6,"div",33),u(7,me,24,5,"div",34),i()()()),s&2){let e=d();a(2),l("ngForOf",e.stockPositions()),a(5),l("ngForOf",e.marketSummary())}}function ge(s,c){if(s&1){let e=S();n(0,"button",68),g("click",function(){f(e);let r=d().$implicit,p=d(2);return x(p.showAdvanceModal(r))}),o(1," \u23ED\uFE0F "),i()}}function ve(s,c){if(s&1&&(n(0,"tr",55)(1,"td")(2,"div",56)(3,"span",57),o(4),i(),n(5,"span",58),o(6),i()()(),n(7,"td")(8,"span",59),o(9),i()(),n(10,"td")(11,"span",60),o(12),i()(),n(13,"td")(14,"span",61),o(15),i()(),n(16,"td")(17,"div",62),w(18,"div",63),n(19,"span",64),o(20),i()()(),n(21,"td")(22,"div",65)(23,"button",66),o(24," \u{1F441}\uFE0F "),i(),u(25,ge,2,0,"button",67),i()()()),s&2){let e=c.$implicit,t=d(2);a(4),m(e.client.name),a(2),m(e.client.id),a(3),m(e.id),a(2),k("background-color",t.getStatusColor(e.status)),a(),O(" ",t.getStatusIcon(e.status)," ",t.getStatusTitle(e.status)," "),a(2),P("overdue",t.isOverdue(e.eta)),a(),v(" ",t.formatETA(e.eta)," "),a(3),k("width",t.getProgress(e.status),"%"),a(2),v("",t.getProgress(e.status),"%"),a(3),l("routerLink",I(15,A,e.id)),a(2),l("ngIf",t.canAdvanceStatus(e))}}function _e(s,c){if(s&1&&(n(0,"div",51)(1,"h3"),o(2),i(),n(3,"div",52)(4,"div",53)(5,"table")(6,"thead")(7,"tr")(8,"th"),o(9,"Cliente"),i(),n(10,"th"),o(11,"Pedido"),i(),n(12,"th"),o(13,"Estado"),i(),n(14,"th"),o(15,"ETA"),i(),n(16,"th"),o(17,"Progreso"),i(),n(18,"th"),o(19,"Acciones"),i()()(),n(20,"tbody"),u(21,ve,26,17,"tr",54),i()()()()()),s&2){let e=d();a(2),v("\u{1F6E3}\uFE0F Entregas por Ruta - ",e.getSelectedRouteName(),""),a(19),l("ngForOf",e.filteredDeliveries())}}function fe(s,c){if(s&1&&(n(0,"div",77)(1,"div",78)(2,"span",59),o(3),i(),n(4,"span",60),o(5),i(),n(6,"span",79),o(7),i(),n(8,"button",80),o(9,"Ver"),i()()()),s&2){let e=c.$implicit,t=d(3);a(3),m(e.id),a(),k("background-color",t.getStatusColor(e.status)),a(),O(" ",t.getStatusIcon(e.status)," ",t.getStatusTitle(e.status)," "),a(2),m(t.formatETA(e.eta)),a(),l("routerLink",I(7,A,e.id))}}function xe(s,c){if(s&1&&(n(0,"div",72)(1,"div",73)(2,"h4"),o(3),i(),n(4,"span",74),o(5),i()(),n(6,"div",75),u(7,fe,10,9,"div",76),i()()),s&2){let e=c.$implicit;a(3),m(e.name),a(2),O("",e.market," - ",e.deliveries.length," pedido(s)"),a(2),l("ngForOf",e.deliveries)}}function he(s,c){if(s&1&&(n(0,"div",69)(1,"h3"),o(2,"\u{1F464} Vista por Cliente"),i(),n(3,"div",70),u(4,xe,8,4,"div",71),i()()),s&2){let e=d();a(4),l("ngForOf",e.groupedByClient())}}function Se(s,c){if(s&1&&(n(0,"span",102),o(1),i()),s&2){let e=d().$implicit;a(),m(e.route.name)}}function be(s,c){if(s&1&&(n(0,"span",103),o(1),i()),s&2){let e=d().$implicit,t=d(2);a(),v(" ",t.formatCurrency(e.contract.amount)," ")}}function Ce(s,c){if(s&1){let e=S();n(0,"button",104),g("click",function(){f(e);let r=d().$implicit,p=d(2);return x(p.showAdvanceModal(r))}),o(1," Avanzar Estado "),i()}}function Ee(s,c){if(s&1&&(n(0,"div",85)(1,"div",86)(2,"div",56)(3,"h4"),o(4),i(),n(5,"span",87),o(6),i(),u(7,Se,2,1,"span",88),i(),n(8,"div",89)(9,"span",59),o(10),i(),n(11,"span",90),o(12),i()()(),n(13,"div",91)(14,"div",92)(15,"span",60),o(16),i(),n(17,"div",62),w(18,"div",63),i(),n(19,"span",64),o(20),i()(),n(21,"div",93)(22,"span",94),o(23,"ETA:"),i(),n(24,"span",95),o(25),i()(),n(26,"div",96)(27,"span",97),o(28,"Contrato:"),i(),n(29,"span",98),o(30),i(),u(31,be,2,1,"span",99),i()(),n(32,"div",100)(33,"button",80),o(34," Ver Detalles "),i(),u(35,Ce,2,0,"button",101),i()()),s&2){let e=c.$implicit,t=d(2);a(4),m(e.client.name),a(2),m(e.market),a(),l("ngIf",e.route),a(3),m(e.id),a(2),m(t.formatDate(e.createdAt)),a(3),k("background-color",t.getStatusColor(e.status)),a(),O(" ",t.getStatusIcon(e.status)," ",t.getStatusTitle(e.status)," "),a(2),k("width",t.getProgress(e.status),"%"),a(2),v("",t.getProgress(e.status),"% completado"),a(4),P("overdue",t.isOverdue(e.eta)),a(),v(" ",t.formatETA(e.eta)," "),a(5),m(e.contract.id),a(),l("ngIf",e.contract.amount),a(2),l("routerLink",I(19,A,e.id)),a(2),l("ngIf",t.canAdvanceStatus(e))}}function ke(s,c){if(s&1){let e=S();n(0,"div",105)(1,"button",106),g("click",function(){f(e);let r=d(2);return x(r.previousPage())}),o(2," \u2190 Anterior "),i(),n(3,"span",107),o(4),i(),n(5,"button",106),g("click",function(){f(e);let r=d(2);return x(r.nextPage())}),o(6," Siguiente \u2192 "),i()()}if(s&2){let e=d(2);a(),l("disabled",e.currentPage()===1),a(3),O(" P\xE1gina ",e.currentPage()," de ",e.totalPages()," "),a(),l("disabled",e.currentPage()===e.totalPages())}}function Oe(s,c){if(s&1&&(n(0,"div",81)(1,"div",82),u(2,Ee,36,21,"div",83),i(),u(3,ke,7,4,"div",84),i()),s&2){let e=d();a(2),l("ngForOf",e.paginatedDeliveries()),a(),l("ngIf",e.totalDeliveries()>e.pageSize())}}function ye(s,c){s&1&&(n(0,"div",108),w(1,"div",109),n(2,"p"),o(3,"Cargando entregas..."),i()())}function De(s,c){if(s&1){let e=S();n(0,"div",117)(1,"button",118),g("click",function(){let r=f(e).$implicit,p=d(3);return x(p.executeTransition(r.event))}),o(2),i(),n(3,"span",119),o(4),i()()}if(s&2){let e=c.$implicit;a(2),v(" ",e.label," "),a(2),m(e.description)}}function Me(s,c){if(s&1){let e=S();n(0,"div")(1,"p")(2,"strong"),o(3,"Pedido:"),i(),o(4),i(),n(5,"p")(6,"strong"),o(7,"Cliente:"),i(),o(8),i(),n(9,"p")(10,"strong"),o(11,"Estado actual:"),i(),o(12),i(),n(13,"div",113),u(14,De,5,2,"div",114),i(),n(15,"div",115)(16,"button",116),g("click",function(){f(e);let r=d(2);return x(r.hideAdvanceModal())}),o(17,"Cancelar"),i()()()}if(s&2){let e=d(2);a(4),v(" ",e.selectedDelivery().id,""),a(4),v(" ",e.selectedDelivery().client.name,""),a(4),v(" ",e.getStatusTitle(e.selectedDelivery().status),""),a(2),l("ngForOf",e.availableActions())}}function Pe(s,c){if(s&1){let e=S();n(0,"div",110),g("click",function(){f(e);let r=d();return x(r.hideAdvanceModal())}),n(1,"div",111),g("click",function(r){return f(e),x(r.stopPropagation())}),n(2,"h3"),o(3,"Avanzar Estado de Entrega"),i(),u(4,Me,18,4,"div",112),i()()}if(s&2){let e=d();a(4),l("ngIf",e.selectedDelivery())}}var Xe=(()=>{class s{constructor(){this.deliveriesService=E(ie),this.stockService=E(ne),this.toastService=E(ee),this.selectedMarket=_(""),this.selectedRoute=_(""),this.clientSearch=_(""),this.selectedStatus=_(""),this.deliveries=_([]),this.stockPositions=_([]),this.stockAlerts=_([]),this.availableRoutes=_([]),this.loading=_(!1),this.stockLoading=_(!1),this.currentPage=_(1),this.pageSize=_(20),this.showAdvanceStateModal=_(!1),this.selectedDelivery=_(null),this.filteredDeliveries=b(()=>{let e=this.deliveries();if(this.selectedMarket()&&(e=e.filter(t=>t.market===this.selectedMarket())),this.selectedRoute()&&(e=e.filter(t=>t.route?.id===this.selectedRoute())),this.clientSearch()){let t=this.clientSearch().toLowerCase();e=e.filter(r=>r.client.name.toLowerCase().includes(t)||r.client.id.toLowerCase().includes(t))}return this.selectedStatus()&&(e=e.filter(t=>t.status===this.selectedStatus())),e}),this.paginatedDeliveries=b(()=>{let e=this.filteredDeliveries(),t=(this.currentPage()-1)*this.pageSize(),r=t+this.pageSize();return e.slice(t,r)}),this.totalDeliveries=b(()=>this.filteredDeliveries().length),this.totalPages=b(()=>Math.ceil(this.totalDeliveries()/this.pageSize())),this.currentView=b(()=>this.selectedMarket()&&!this.selectedRoute()&&!this.clientSearch()?"market":this.selectedRoute()?"route":this.clientSearch()?"client":"general"),this.marketSummary=b(()=>["AGS","EdoMex"].map(t=>{let r=this.deliveries().filter(p=>p.market===t);return{market:t,total:r.length,inTransit:r.filter(p=>["ON_VESSEL","AT_DEST_PORT","IN_CUSTOMS","RELEASED"].includes(p.status)).length,readyForDelivery:r.filter(p=>p.status==="READY_FOR_HANDOVER").length,delivered:r.filter(p=>p.status==="DELIVERED").length}})),this.groupedByClient=b(()=>{let e=new Map;return this.filteredDeliveries().forEach(t=>{let r=t.client.id;e.has(r)||e.set(r,{name:t.client.name,market:t.client.market,deliveries:[]}),e.get(r).deliveries.push(t)}),Array.from(e.values())}),this.availableActions=b(()=>{let e=this.selectedDelivery();return e?this.deliveriesService.getAvailableActions(e,"ops"):[]}),this.deliveryStatuses=["PO_ISSUED","IN_PRODUCTION","READY_AT_FACTORY","AT_ORIGIN_PORT","ON_VESSEL","AT_DEST_PORT","IN_CUSTOMS","RELEASED","AT_WH","READY_FOR_HANDOVER","DELIVERED"],$(()=>{this.selectedMarket()==="EdoMex"?this.loadRoutes():(this.selectedRoute.set(""),this.availableRoutes.set([]))})}ngOnInit(){this.loadData()}loadData(){this.loading.set(!0);let e={market:this.selectedMarket()||void 0,routeId:this.selectedRoute()||void 0,clientId:this.clientSearch()||void 0,status:this.selectedStatus()?[this.selectedStatus()]:void 0,limit:100};this.deliveriesService.list(e).pipe(T(()=>this.loading.set(!1))).subscribe({next:t=>{this.deliveries.set(t.items)},error:t=>{this.toastService.error(t.userMessage||"Error cargando entregas")}}),this.loadStockData()}loadStockData(){this.stockLoading.set(!0);let t=["AGS","EdoMex"].map(r=>this.stockService.getAllPositions(r).toPromise());Promise.all(t).then(r=>{let p=r.flat().filter(Boolean);this.stockPositions.set(p)}).catch(r=>{console.error("Error loading stock positions:",r)}),this.stockService.getAlerts().pipe(T(()=>this.stockLoading.set(!1))).subscribe({next:r=>{this.stockAlerts.set(r)},error:r=>{console.error("Error loading stock alerts:",r)}})}loadRoutes(){this.selectedMarket()&&this.deliveriesService.getRoutes(this.selectedMarket()).subscribe({next:e=>{this.availableRoutes.set(e)},error:e=>{console.error("Error loading routes:",e)}})}onMarketChange(){this.selectedRoute.set(""),this.currentPage.set(1),this.loadData()}onRouteChange(){this.currentPage.set(1),this.loadData()}onClientSearch(){this.currentPage.set(1),setTimeout(()=>this.loadData(),300)}onStatusChange(){this.currentPage.set(1),this.loadData()}clearFilters(){this.selectedMarket.set(""),this.selectedRoute.set(""),this.clientSearch.set(""),this.selectedStatus.set(""),this.currentPage.set(1),this.loadData()}hasActiveFilters(){return!!(this.selectedMarket()||this.selectedRoute()||this.clientSearch()||this.selectedStatus())}refreshData(){this.loadData()}recomputeStock(){this.stockService.recomputeForecast().subscribe({next:e=>{this.toastService.success(e.message),this.loadStockData()},error:e=>{this.toastService.error(e.userMessage||"Error recalculando stock")}})}showAdvanceModal(e){this.selectedDelivery.set(e),this.showAdvanceStateModal.set(!0)}hideAdvanceModal(){this.showAdvanceStateModal.set(!1),this.selectedDelivery.set(null)}executeTransition(e){let t=this.selectedDelivery();t&&this.deliveriesService.transition(t.id,{event:e}).subscribe({next:r=>{r.success?(this.toastService.success(r.message),this.hideAdvanceModal(),this.loadData()):this.toastService.error(r.message)},error:r=>{this.toastService.error(r.userMessage||"Error avanzando estado")}})}previousPage(){this.currentPage()>1&&this.currentPage.update(e=>e-1)}nextPage(){this.currentPage()<this.totalPages()&&this.currentPage.update(e=>e+1)}getMarketName(e){return e==="AGS"?"Aguascalientes":"Estado de M\xE9xico"}getSelectedRouteName(){let e=this.availableRoutes().find(t=>t.id===this.selectedRoute());return e?e.name:""}getStatusTitle(e){return te[e]?.title||e}getStatusColor(e){return this.deliveriesService.getStatusColor(e)}getStatusIcon(e){return this.deliveriesService.getStatusIcon(e)}getProgress(e){return this.deliveriesService.getDeliveryProgress(e)}formatETA(e){if(!e)return"Por definir";let t=new Date(e);return new Intl.DateTimeFormat("es-MX",{day:"numeric",month:"short",year:"numeric"}).format(t)}formatDate(e){return new Intl.DateTimeFormat("es-MX",{day:"numeric",month:"short"}).format(new Date(e))}formatCurrency(e){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e)}isOverdue(e){return e?new Date(e)<new Date:!1}canAdvanceStatus(e){return this.deliveriesService.getAvailableActions(e,"ops").length>0}getMarketAlerts(e){return this.stockAlerts().filter(t=>t.market===e&&!t.resolved)}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=V({type:s,selectors:[["app-ops-deliveries"]],standalone:!0,features:[N],decls:45,vars:18,consts:[[1,"ops-deliveries-container"],[1,"ops-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],[1,"header-actions"],[1,"btn-refresh",3,"click","disabled"],[1,"btn-recompute",3,"click","disabled"],[1,"hierarchical-filters"],[1,"filter-level"],[1,"filter-label"],[1,"filter-select",3,"ngModelChange","change","ngModel"],["value",""],["value","AGS"],["value","EdoMex"],["class","filter-level",4,"ngIf"],["type","text","placeholder","Buscar por nombre de cliente...",1,"filter-input",3,"ngModelChange","input","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-summary"],[1,"results-count"],["class","btn-clear-filters",3,"click",4,"ngIf"],["class","market-view",4,"ngIf"],["class","route-view",4,"ngIf"],["class","client-view",4,"ngIf"],["class","general-view",4,"ngIf"],["class","loading-overlay",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value"],[1,"btn-clear-filters",3,"click"],[1,"market-view"],[1,"stock-cards"],["class","stock-card",4,"ngFor","ngForOf"],[1,"market-summary"],[1,"summary-grid"],["class","summary-card",4,"ngFor","ngForOf"],[1,"stock-card"],[1,"stock-header"],[1,"sku-badge"],[1,"stock-metrics"],[1,"metric"],[1,"metric-label"],[1,"metric-value"],["class","stock-alerts",4,"ngIf"],[1,"stock-alerts"],["class","alert-item",3,"class",4,"ngFor","ngForOf"],[1,"alert-item"],[1,"summary-card"],[1,"summary-stats"],[1,"stat"],[1,"stat-value"],[1,"stat-label"],[1,"route-view"],[1,"route-deliveries"],[1,"delivery-table"],["class","delivery-row",4,"ngFor","ngForOf"],[1,"delivery-row"],[1,"client-info"],[1,"client-name"],[1,"client-id"],[1,"order-id"],[1,"status-badge"],[1,"eta-date"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"action-buttons"],["title","Ver detalles",1,"btn-action","btn-view",3,"routerLink"],["class","btn-action btn-advance","title","Avanzar estado",3,"click",4,"ngIf"],["title","Avanzar estado",1,"btn-action","btn-advance",3,"click"],[1,"client-view"],[1,"client-deliveries"],["class","client-group",4,"ngFor","ngForOf"],[1,"client-group"],[1,"client-header"],[1,"client-meta"],[1,"client-delivery-list"],["class","delivery-item",4,"ngFor","ngForOf"],[1,"delivery-item"],[1,"delivery-summary"],[1,"eta"],[1,"btn-view",3,"routerLink"],[1,"general-view"],[1,"delivery-grid"],["class","delivery-card",4,"ngFor","ngForOf"],["class","pagination",4,"ngIf"],[1,"delivery-card"],[1,"card-header"],[1,"market-badge"],["class","route-badge",4,"ngIf"],[1,"order-meta"],[1,"created-date"],[1,"card-body"],[1,"status-section"],[1,"eta-section"],[1,"eta-label"],[1,"eta-value"],[1,"contract-section"],[1,"contract-label"],[1,"contract-value"],["class","contract-amount",4,"ngIf"],[1,"card-actions"],["class","btn-advance",3,"click",4,"ngIf"],[1,"route-badge"],[1,"contract-amount"],[1,"btn-advance",3,"click"],[1,"pagination"],[1,"btn-page",3,"click","disabled"],[1,"page-info"],[1,"loading-overlay"],[1,"loading-spinner"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[4,"ngIf"],[1,"available-actions"],["class","action-option",4,"ngFor","ngForOf"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"action-option"],[1,"btn-action-option",3,"click"],[1,"action-description"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"\u{1F69A} Centro de Operaciones - Entregas"),i(),n(5,"p",4),o(6,"Gesti\xF3n completa del ciclo de entregas (77 d\xEDas)"),i()(),n(7,"div",5)(8,"button",6),g("click",function(){return r.refreshData()}),o(9),i(),n(10,"button",7),g("click",function(){return r.recomputeStock()}),o(11," \u{1F4CA} Recalcular Stock "),i()()(),n(12,"div",8)(13,"div",9)(14,"label",10),o(15,"\u{1F4CD} Mercado"),i(),n(16,"select",11),M("ngModelChange",function(h){return D(r.selectedMarket,h)||(r.selectedMarket=h),h}),g("change",function(){return r.onMarketChange()}),n(17,"option",12),o(18,"Todos los mercados"),i(),n(19,"option",13),o(20,"Aguascalientes (CON asientos)"),i(),n(21,"option",14),o(22,"Estado de M\xE9xico (SIN asientos)"),i()()(),u(23,oe,7,2,"div",15),n(24,"div",9)(25,"label",10),o(26,"\u{1F464} Cliente"),i(),n(27,"input",16),M("ngModelChange",function(h){return D(r.clientSearch,h)||(r.clientSearch=h),h}),g("input",function(){return r.onClientSearch()}),i()(),n(28,"div",9)(29,"label",10),o(30,"\u{1F4E6} Estado"),i(),n(31,"select",11),M("ngModelChange",function(h){return D(r.selectedStatus,h)||(r.selectedStatus=h),h}),g("change",function(){return r.onStatusChange()}),n(32,"option",12),o(33,"Todos los estados"),i(),u(34,se,2,2,"option",17),i()(),n(35,"div",18)(36,"span",19),o(37),i(),u(38,le,2,0,"button",20),i()(),u(39,ue,8,2,"div",21)(40,_e,22,2,"div",22)(41,he,5,1,"div",23)(42,Oe,4,2,"div",24)(43,ye,4,0,"div",25)(44,Pe,5,1,"div",26),i()),t&2&&(a(8),l("disabled",r.loading()),a(),v(" ",r.loading()?"\u23F3":"\u{1F504}"," Actualizar "),a(),l("disabled",r.stockLoading()),a(6),y("ngModel",r.selectedMarket),a(7),l("ngIf",r.selectedMarket()==="EdoMex"),a(4),y("ngModel",r.clientSearch),a(4),y("ngModel",r.selectedStatus),a(3),l("ngForOf",r.deliveryStatuses),a(3),L(" ",r.filteredDeliveries().length," pedido",r.filteredDeliveries().length!==1?"s":""," encontrado",r.filteredDeliveries().length!==1?"s":""," "),a(),l("ngIf",r.hasActiveFilters()),a(),l("ngIf",r.currentView()==="market"),a(),l("ngIf",r.currentView()==="route"),a(),l("ngIf",r.currentView()==="client"),a(),l("ngIf",r.currentView()==="general"),a(),l("ngIf",r.loading()),a(),l("ngIf",r.showAdvanceStateModal()))},dependencies:[j,U,W,Z,K,Q,Y,J,X,q,H,G],styles:[".ops-deliveries-container[_ngcontent-%COMP%]{padding:24px;background:#0f1419;color:#fff;min-height:100vh}.ops-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:32px;background:#1a1f2e;padding:24px;border-radius:12px;border:1px solid #2d3748}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;margin:0 0 8px;color:#06d6a0}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:#a0aec0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-refresh[_ngcontent-%COMP%], .btn-recompute[_ngcontent-%COMP%]{padding:12px 20px;background:#2d3748;color:#fff;border:2px solid #4a5568;border-radius:8px;cursor:pointer;font-weight:600;transition:all .2s}.btn-refresh[_ngcontent-%COMP%]:hover, .btn-recompute[_ngcontent-%COMP%]:hover{background:#4a5568;border-color:#06d6a0}.hierarchical-filters[_ngcontent-%COMP%]{background:#1a1f2e;padding:24px;border-radius:12px;margin-bottom:24px;border:1px solid #2d3748}.filter-level[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:16px}.filter-label[_ngcontent-%COMP%]{font-weight:600;color:#e2e8f0;min-width:100px}.filter-select[_ngcontent-%COMP%], .filter-input[_ngcontent-%COMP%]{padding:8px 12px;background:#2d3748;border:1px solid #4a5568;border-radius:6px;color:#fff;min-width:200px}.filter-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #2d3748}.results-count[_ngcontent-%COMP%]{color:#06d6a0;font-weight:600}.btn-clear-filters[_ngcontent-%COMP%]{padding:6px 12px;background:#dc2626;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px}.stock-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:24px}.stock-card[_ngcontent-%COMP%]{background:#1a1f2e;padding:20px;border-radius:12px;border:1px solid #2d3748}.stock-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.sku-badge[_ngcontent-%COMP%]{padding:4px 8px;background:#06d6a0;color:#fff;border-radius:4px;font-size:12px;font-weight:600}.stock-metrics[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:16px}.metric[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.metric-label[_ngcontent-%COMP%]{font-size:12px;color:#a0aec0}.metric-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#e2e8f0}.metric-value.low-stock[_ngcontent-%COMP%]{color:#f59e0b}.alert-item[_ngcontent-%COMP%]{padding:8px;border-radius:4px;font-size:12px;margin-bottom:4px}.alert-high[_ngcontent-%COMP%]{background:#7c2d12;color:#fbbf24}.alert-medium[_ngcontent-%COMP%]{background:#713f12;color:#f59e0b}.delivery-table[_ngcontent-%COMP%]{background:#1a1f2e;border-radius:12px;overflow:hidden}.delivery-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.delivery-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#2d3748;color:#a0aec0;font-weight:600;padding:12px;text-align:left}.delivery-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #2d3748}.client-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.client-name[_ngcontent-%COMP%]{font-weight:600;color:#e2e8f0}.client-id[_ngcontent-%COMP%]{font-size:12px;color:#a0aec0}.order-id[_ngcontent-%COMP%]{font-family:monospace;background:#2d3748;padding:2px 6px;border-radius:4px;font-size:12px}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:600;color:#fff}.progress-bar[_ngcontent-%COMP%]{position:relative;width:80px;height:6px;background:#2d3748;border-radius:3px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#06d6a0,#10b981);transition:width .3s ease}.progress-text[_ngcontent-%COMP%]{font-size:10px;color:#a0aec0}.eta-date.overdue[_ngcontent-%COMP%]{color:#f87171;font-weight:600}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-action[_ngcontent-%COMP%]{padding:6px;border:none;border-radius:4px;cursor:pointer;font-size:14px}.btn-view[_ngcontent-%COMP%]{background:#3b82f6}.btn-advance[_ngcontent-%COMP%]{background:#06d6a0}.delivery-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:20px}.delivery-card[_ngcontent-%COMP%]{background:#1a1f2e;border:1px solid #2d3748;border-radius:12px;padding:20px;transition:all .2s}.delivery-card[_ngcontent-%COMP%]:hover{border-color:#06d6a0}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}.market-badge[_ngcontent-%COMP%], .route-badge[_ngcontent-%COMP%]{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:600}.market-badge[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.route-badge[_ngcontent-%COMP%]{background:#8b5cf6;color:#fff}.card-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:16px}.btn-view[_ngcontent-%COMP%], .btn-advance[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;text-decoration:none;color:#fff;text-align:center}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}.loading-spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid #2d3748;border-left-color:#06d6a0;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#1a1f2e;border-radius:12px;padding:24px;width:90%;max-width:500px;border:1px solid #2d3748}.available-actions[_ngcontent-%COMP%]{margin:20px 0}.action-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:12px}.btn-action-option[_ngcontent-%COMP%]{padding:8px 16px;background:#06d6a0;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600}.action-description[_ngcontent-%COMP%]{font-size:14px;color:#a0aec0}@media (max-width: 768px){.ops-deliveries-container[_ngcontent-%COMP%], .hierarchical-filters[_ngcontent-%COMP%]{padding:16px}.filter-level[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.delivery-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.delivery-table[_ngcontent-%COMP%]{overflow-x:auto}}"]})}}return s})();export{Xe as OpsDeliveriesComponent};
